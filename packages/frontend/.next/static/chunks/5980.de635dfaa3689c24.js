"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5980],{55980:function(e,a,t){t.r(a),t.d(a,{UsersDashboard:function(){return UsersDashboard}});var s=t(52322),n=t(2784),l=t(69692),i=t(35744),d=t(62197),r=t(8204),u=t(72841),h=t(12352),c=t(95775),o=t(69089),m=t(35936),f=t(6060),v=t(45596),x=t(425);let UserForm=e=>{var a;let{open:t,onClose:i,onSubmit:d,user:u,tenants:h}=e,[c,p]=(0,n.useState)({firstName:"",lastName:"",email:"",role:"user",status:"active",tenant:void 0,password:""});(0,n.useEffect)(()=>{u?p({...u,tenant:u.tenant?{id:u.tenant.id,name:u.tenant.name}:void 0,password:""}):p({firstName:"",lastName:"",email:"",role:"user",status:"active",tenant:void 0,password:""})},[u]);let handleChange=e=>{let{name:a,value:t}=e.target;if("tenantId"===a){let e=h.find(e=>e.id===t);p({...c,tenant:e})}else p({...c,[a]:t})};return(0,s.jsxs)(o.Z,{open:t,onClose:i,fullWidth:!0,maxWidth:"sm",children:[(0,s.jsx)(m.Z,{children:u?"Edit User":"Add User"}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(l.Z,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[(0,s.jsx)(v.Z,{label:"First Name",name:"firstName",value:c.firstName,onChange:handleChange,fullWidth:!0,required:!0}),(0,s.jsx)(v.Z,{label:"Last Name",name:"lastName",value:c.lastName,onChange:handleChange,fullWidth:!0,required:!0}),(0,s.jsx)(v.Z,{label:"Email",name:"email",value:c.email,onChange:handleChange,fullWidth:!0,required:!0}),!u&&(0,s.jsx)(v.Z,{label:"Password",name:"password",type:"password",value:c.password,onChange:handleChange,fullWidth:!0,required:!0}),(0,s.jsx)(v.Z,{select:!0,label:"Tenant",name:"tenantId",value:(null===(a=c.tenant)||void 0===a?void 0:a.id)||"",onChange:handleChange,fullWidth:!0,required:!0,children:h.map(e=>(0,s.jsx)(x.Z,{value:e.id,children:e.name},e.id))}),(0,s.jsxs)(v.Z,{select:!0,label:"Status",name:"status",value:c.status,onChange:handleChange,fullWidth:!0,children:[(0,s.jsx)(x.Z,{value:"active",children:"Active"}),(0,s.jsx)(x.Z,{value:"suspended",children:"Suspended"})]}),(0,s.jsxs)(v.Z,{select:!0,label:"Role",name:"role",value:c.role,onChange:handleChange,fullWidth:!0,children:[(0,s.jsx)(x.Z,{value:"user",children:"User"}),(0,s.jsx)(x.Z,{value:"admin",children:"Admin"})]}),(0,s.jsx)(r.Z,{variant:"contained",onClick:()=>{if(!c.firstName||!c.lastName||!c.email||!c.role||!c.status||!c.tenant){alert("Please fill all required fields");return}d(c)},children:u?"Update":"Add"})]})})]})};var p=t(52849);let UsersDashboard=()=>{let{get:e,post:a,put:t,patch:o}=(0,c.h)(),[m,f]=(0,n.useState)([]),[v,x]=(0,n.useState)([]),[g,j]=(0,n.useState)(!0),[Z,C]=(0,n.useState)(null),[b,N]=(0,n.useState)(!1),[w,S]=(0,n.useState)(null),fetchData=async()=>{j(!0);try{let a=await e("/api/super-admin/users"),t=await e("/api/super-admin/tenants");f(a.data||[]),x(t.data||[]),C(null)}catch(e){C(e.message||"Failed to fetch data")}finally{j(!1)}};(0,n.useEffect)(()=>{fetchData()},[]);let handleEdit=e=>{S(e),N(!0)},handleSubmit=async e=>{try{w?await t("/api/super-admin/users/".concat(w.id),e):await a("/api/super-admin/users",e),N(!1),fetchData()}catch(e){alert(e.message||"Failed to save user")}},handleStatusChange=async e=>{try{await o("/api/super-admin/users/".concat(e.id,"/status"),{isActive:"active"!==e.status}),fetchData()}catch(e){alert(e.message||"Failed to change status")}};return(0,s.jsxs)(l.Z,{component:i.Z,sx:{p:3,borderRadius:2},children:[(0,s.jsxs)(l.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,s.jsx)(d.Z,{variant:"h6",children:"Users Management"}),(0,s.jsx)(r.Z,{variant:"contained",onClick:()=>{S(null),N(!0)},children:"Add User"})]}),g&&(0,s.jsxs)(l.Z,{textAlign:"center",py:5,children:[(0,s.jsx)(u.Z,{}),(0,s.jsx)(d.Z,{mt:2,children:"Loading..."})]}),Z&&(0,s.jsx)(h.Z,{severity:"error",children:Z}),!g&&m.length>0&&(0,s.jsx)(p.w,{title:"Users",resource:"users",data:m,columns:[{id:"firstName",label:"First Name"},{id:"lastName",label:"Last Name"},{id:"email",label:"Email"},{id:"role",label:"Role"},{id:"tenant",label:"Tenant",format:e=>{var a;return(null===(a=e.tenant)||void 0===a?void 0:a.name)||"-"}},{id:"status",label:"Status",format:e=>"active"===e.status?"Active":"Inactive"},{id:"createdAt",label:"Created At",format:e=>e.createdAt?new Date(e.createdAt).toLocaleDateString():"-"}],onEdit:e=>{let a=m.find(a=>a.id===e);a&&handleEdit(a)},onStatusChange:e=>{let a=m.find(a=>a.id===e);a&&handleStatusChange(a)}}),!g&&0===m.length&&(0,s.jsx)(d.Z,{children:"No users found."}),(0,s.jsx)(UserForm,{open:b,onClose:()=>N(!1),onSubmit:handleSubmit,user:w,tenants:v})]})}}}]);