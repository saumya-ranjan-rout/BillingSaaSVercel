(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2888],{86570:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(6918)}])},78e3:function(e,t,r){"use strict";r.d(t,{AP:function(){return selectAuthLoading},D0:function(){return selectCurrentToken},Dj:function(){return i},HF:function(){return selectCurrentUser},Hn:function(){return selectAuthError},PF:function(){return d},g$:function(){return l},kS:function(){return g},sT:function(){return p}});var a=r(29829),n=r(60418),s=r(93542);let getStoredItem=e=>{try{return localStorage.getItem(e)}catch(e){return null}},u=(()=>{try{let e=getStoredItem("authToken"),t=getStoredItem("user"),r=getStoredItem("currentTenant");return{token:e||null,user:t?JSON.parse(t):null,currentTenant:r?JSON.parse(r):null}}catch(e){return{token:null,user:null,currentTenant:null}}})(),o={user:u.user||null,token:u.token||null,isLoading:!1,error:null,currentTenant:u.currentTenant||null},l=(0,a.hg)("auth/refreshToken",async(e,t)=>{var r,a,u;let{rejectWithValue:o}=t;try{let e=localStorage.getItem("refreshToken");if(!e)throw Error("No refresh token found");let t=await n.Z.post("".concat(s.env.NEXT_PUBLIC_API_URL,"/auth/refresh-token"),{refreshToken:e}),a=null===(r=t.data)||void 0===r?void 0:r.accessToken;if(a)return localStorage.setItem("authToken",a),a;throw Error("Invalid refresh token response")}catch(e){return o((null===(u=e.response)||void 0===u?void 0:null===(a=u.data)||void 0===a?void 0:a.message)||"Failed to refresh token")}}),c=(0,a.oM)({name:"auth",initialState:o,reducers:{setCredentials:(e,t)=>{e.user=t.payload.user,e.token=t.payload.token,e.error=null;try{localStorage.setItem("user",JSON.stringify(t.payload.user)),localStorage.setItem("authToken",t.payload.token),t.payload.refreshToken&&localStorage.setItem("refreshToken",t.payload.refreshToken)}catch(e){}},setCurrentTenant:(e,t)=>{e.currentTenant=t.payload;try{localStorage.setItem("currentTenant",JSON.stringify(t.payload))}catch(e){}},setLoading:(e,t)=>{e.isLoading=t.payload},setError:(e,t)=>{e.error=t.payload},logout:e=>{e.user=null,e.token=null,e.currentTenant=null,e.error=null,e.isLoading=!1;try{localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("currentTenant")}catch(e){}}},extraReducers:e=>{e.addCase(l.fulfilled,(e,t)=>{e.token=t.payload})}}),{setCredentials:i,setCurrentTenant:d,setLoading:h,setError:p,logout:g}=c.actions;t.ZP=c.reducer;let selectCurrentUser=e=>e.auth.user,selectCurrentToken=e=>e.auth.token,selectAuthLoading=e=>e.auth.isLoading,selectAuthError=e=>e.auth.error},6918:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _app}});var a=r(52322),n=r(2784),s=r(94449),u=r(40888),o=r(1505),l=r(78e3),c=r(17584);let i={async getCurrentTenant(){let e=await c.Z.get("/tenant");return e.data},async updateTenant(e){let t=await c.Z.put("/tenant",e);return t.data},async getBillingInfo(){let e=await c.Z.get("/tenant/billing");return e.data},async updateBillingInfo(e){let t=await c.Z.put("/tenant/billing",e);return t.data},async getSubscription(){let e=await c.Z.get("/tenant/subscription");return e.data},async updateSubscription(e){let t=await c.Z.put("/tenant/subscription",{plan:e});return t.data}},d={async login(e,t,r){let a=await c.Z.post("/auth/login",{email:e,password:t,tenantId:r});return a.data},async register(e){let t=await c.Z.post("/auth/register",e);return t.data},async getCurrentUser(){let e=await c.Z.get("/auth/me");return e.data},async requestPasswordReset(e){let t=await c.Z.post("/auth/forgot-password",{email:e});return t.data},async resetPassword(e,t){let r=await c.Z.post("/auth/reset-password",{token:e,password:t});return r.data},async getTenantsForUser(e){let t=await c.Z.get("/auth/tenants/".concat(e));return t.data}},h=(0,n.createContext)(void 0),AuthProvider=e=>{let{children:t}=e,[r,s]=(0,n.useState)(null),[u,o]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("authToken");e?d.getCurrentUser().then(e=>{s(e)}).catch(()=>{localStorage.removeItem("authToken")}).finally(()=>{o(!1)}):o(!1)},[]);let login=async(e,t,r)=>{try{let a=await d.login(e,t,r);s(a.user),localStorage.setItem("authToken",a.token)}catch(e){throw e}},register=async e=>{try{let t=await d.register(e);s(t.user),localStorage.setItem("authToken",t.token)}catch(e){throw e}};return(0,a.jsx)(h.Provider,{value:{user:r,setUser:s,loading:u,login,logout:()=>{s(null),localStorage.removeItem("authToken")},register},children:!u&&t})},useAuth=()=>{let e=(0,n.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},p=(0,n.createContext)(void 0),TenantProvider=e=>{let{children:t}=e,[r,s]=(0,n.useState)(null),[u,o]=(0,n.useState)(!0),{user:l}=useAuth();(0,n.useEffect)(()=>{l?loadTenant():o(!1)},[l]);let loadTenant=async()=>{try{let e=await i.getCurrentTenant();s(e)}catch(e){}finally{o(!1)}},updateTenant=async e=>{try{let t=await i.updateTenant(e);s(t)}catch(e){throw e}};return(0,a.jsx)(p.Provider,{value:{tenant:r,loading:u,updateTenant},children:t})};r(43596);var g=r(56958),y=r(41633),m=r(90740);function AppContent(e){let{Component:t,pageProps:r}=e,s=(0,o.TL)(),[c,i]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{i(!0);try{let e=localStorage.getItem("user"),t=localStorage.getItem("authToken"),r=localStorage.getItem("tenant"),a=e?JSON.parse(e):null,n=t||null,s=r?JSON.parse(r):null;a&&n&&u.h.dispatch((0,l.Dj)({user:a,token:n})),s&&u.h.dispatch((0,l.PF)(s))}catch(e){}},[s]),c)?(0,a.jsxs)(y._,{dateAdapter:m.y,children:[(0,a.jsx)(t,{...r}),(0,a.jsx)(g.x7,{position:"top-right"})]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})}var _app=function(e){return(0,a.jsx)(s.zt,{store:u.h,children:(0,a.jsx)(AuthProvider,{children:(0,a.jsx)(TenantProvider,{children:(0,a.jsx)(AppContent,{...e})})})})}},32684:function(e,t,r){"use strict";r.d(t,{h:function(){return u}});var a=r(45673),n=r(30848);let s=(0,a.ni)({baseUrl:"http://192.168.29.17:3001/api",prepareHeaders:(e,t)=>{let{getState:r}=t,a=r().auth.token;return a&&e.set("authorization","Bearer ".concat(a)),e}}),u=(0,n.LC)({reducerPath:"api",baseQuery:s,tagTypes:["User","Invoice","Customer","Product","Subscription","PaymentMethods"],endpoints:()=>({})})},17584:function(e,t,r){"use strict";var a=r(60418),n=r(40888),s=r(78e3),u=r(56958),o=r(93542);let l=o.env.NEXT_PUBLIC_API_URL||"http://192.168.29.17:3001/api",c=a.Z.create({baseURL:l,headers:{"Content-Type":"application/json"},withCredentials:!0});c.interceptors.request.use(e=>{let t=n.h.getState(),r=t.auth.token||localStorage.getItem("token");return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e));let i=!1,d=[],processQueue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;d.forEach(r=>{e?r.reject(e):r.resolve(t)}),d=[]};c.interceptors.response.use(e=>e.data,async e=>{var t,r,a;let o=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!o._retry){if(i)return new Promise(function(e,t){d.push({resolve:e,reject:t})}).then(e=>(o.headers.Authorization="Bearer ".concat(e),c(o))).catch(e=>Promise.reject(e));o._retry=!0,i=!0;try{let e=await n.h.dispatch((0,s.g$)()).unwrap();if(e)return processQueue(null,e),o.headers.Authorization="Bearer ".concat(e),c(o)}catch(e){return processQueue(e,null),n.h.dispatch((0,s.kS)()),u.Am.error("Session expired, please login again."),Promise.reject(e)}finally{i=!1}}return(null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)&&u.Am.error(e.response.data.message),Promise.reject(e)}),t.Z=c},1505:function(e,t,r){"use strict";r.d(t,{CG:function(){return n},TL:function(){return useAppDispatch}});var a=r(94449);let useAppDispatch=()=>(0,a.I0)(),n=a.v9},40888:function(e,t,r){"use strict";r.d(t,{h:function(){return Q}});var a=r(29829),n=r(32684),s=r(30848),u=r(45673);let o=(0,s.LC)({reducerPath:"purchasesApi",baseQuery:(0,u.ni)({baseUrl:"/api"}),tagTypes:["PurchaseOrder"],endpoints:e=>({getPurchaseOrders:e.query({query:e=>({url:"/purchases/orders",params:e}),providesTags:["PurchaseOrder"]}),getPurchaseOrderById:e.query({query:e=>"/purchases/orders/".concat(e),providesTags:(e,t,r)=>[{type:"PurchaseOrder",id:r}]}),createPurchaseOrder:e.mutation({query:e=>({url:"/purchases/orders",method:"POST",body:e}),invalidatesTags:["PurchaseOrder"]}),updatePurchaseOrder:e.mutation({query:e=>{let{id:t,data:r}=e;return{url:"/purchases/orders/".concat(t),method:"PUT",body:r}},invalidatesTags:(e,t,r)=>{let{id:a}=r;return[{type:"PurchaseOrder",id:a}]}}),deletePurchaseOrder:e.mutation({query:e=>({url:"/purchases/orders/".concat(e),method:"DELETE"}),invalidatesTags:["PurchaseOrder"]}),updatePurchaseOrderStatus:e.mutation({query:e=>{let{id:t,status:r}=e;return{url:"/purchases/orders/".concat(t,"/status"),method:"PATCH",body:{status:r}}},invalidatesTags:(e,t,r)=>{let{id:a}=r;return[{type:"PurchaseOrder",id:a}]}}),receivePurchaseOrderItems:e.mutation({query:e=>{let{id:t,receivedItems:r}=e;return{url:"/purchases/orders/".concat(t,"/receive"),method:"POST",body:{receivedItems:r}}},invalidatesTags:(e,t,r)=>{let{id:a}=r;return[{type:"PurchaseOrder",id:a}]}}),getPurchaseOrdersByVendor:e.query({query:e=>{let{vendorId:t,...r}=e;return{url:"/purchases/vendors/".concat(t,"/orders"),params:r}},providesTags:["PurchaseOrder"]}),getPurchaseStatistics:e.query({query:e=>({url:"/purchases/statistics",params:e})}),exportPurchaseOrders:e.mutation({query:e=>({url:"/purchases/export",method:"GET",params:e,responseHandler:e=>e.blob()})}),uploadAttachment:e.mutation({query:e=>{let{id:t,file:r}=e,a=new FormData;return a.append("file",r),{url:"/purchases/orders/".concat(t,"/attachments"),method:"POST",body:a}},invalidatesTags:(e,t,r)=>{let{id:a}=r;return[{type:"PurchaseOrder",id:a}]}}),deleteAttachment:e.mutation({query:e=>{let{id:t,attachmentId:r}=e;return{url:"/purchases/orders/".concat(t,"/attachments/").concat(r),method:"DELETE"}},invalidatesTags:(e,t,r)=>{let{id:a}=r;return[{type:"PurchaseOrder",id:a}]}}),getAuditLog:e.query({query:e=>"/purchases/orders/".concat(e,"/audit-log")})})}),{useGetPurchaseOrdersQuery:l,useGetPurchaseOrderByIdQuery:c,useCreatePurchaseOrderMutation:i,useUpdatePurchaseOrderMutation:d,useDeletePurchaseOrderMutation:h,useUpdatePurchaseOrderStatusMutation:p,useReceivePurchaseOrderItemsMutation:g,useGetPurchaseOrdersByVendorQuery:y,useGetPurchaseStatisticsQuery:m,useExportPurchaseOrdersMutation:f,useUploadAttachmentMutation:v,useDeleteAttachmentMutation:T,useGetAuditLogQuery:P}=o;var S=r(78e3);let k={selectedInvoice:null,filters:{status:"all",customer:"",dateRange:{start:"",end:""}}},w=(0,a.oM)({name:"invoices",initialState:k,reducers:{setSelectedInvoice:(e,t)=>{e.selectedInvoice=t.payload},clearSelectedInvoice:e=>{e.selectedInvoice=null},setStatusFilter:(e,t)=>{e.filters.status=t.payload},setCustomerFilter:(e,t)=>{e.filters.customer=t.payload},setDateRangeFilter:(e,t)=>{e.filters.dateRange=t.payload},clearFilters:e=>{e.filters=k.filters}}}),{setSelectedInvoice:I,clearSelectedInvoice:_,setStatusFilter:C,setCustomerFilter:O,setDateRangeFilter:A,clearFilters:b}=w.actions;var E=w.reducer;let x={selectedCustomer:null,filters:{search:""}},j=(0,a.oM)({name:"customers",initialState:x,reducers:{setSelectedCustomer:(e,t)=>{e.selectedCustomer=t.payload},clearSelectedCustomer:e=>{e.selectedCustomer=null},setSearchFilter:(e,t)=>{e.filters.search=t.payload},clearFilters:e=>{e.filters=x.filters}}}),{setSelectedCustomer:q,clearSelectedCustomer:L,setSearchFilter:F,clearFilters:Z}=j.actions;var N=j.reducer;let U={selectedProduct:null,filters:{search:"",active:null}},B=(0,a.oM)({name:"products",initialState:U,reducers:{setSelectedProduct:(e,t)=>{e.selectedProduct=t.payload},clearSelectedProduct:e=>{e.selectedProduct=null},setSearchFilter:(e,t)=>{e.filters.search=t.payload},setActiveFilter:(e,t)=>{e.filters.active=t.payload},clearFilters:e=>{e.filters=U.filters}}}),{setSelectedProduct:D,clearSelectedProduct:R,setSearchFilter:z,setActiveFilter:J,clearFilters:H}=B.actions;var M=B.reducer;let Q=(0,a.xC)({reducer:{auth:S.ZP,invoices:E,customers:N,products:M,[n.h.reducerPath]:n.h.reducer,[o.reducerPath]:o.reducer},middleware:e=>e({serializableCheck:{ignoredActions:["persist/PERSIST"],ignoredPaths:["api.mutations"]}}).concat(n.h.middleware).concat(o.middleware),devTools:!1})},43596:function(){}},function(e){var __webpack_exec__=function(t){return e(e.s=t)};e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,179],function(){return __webpack_exec__(86570),__webpack_exec__(65123)}),_N_E=e.O()}]);