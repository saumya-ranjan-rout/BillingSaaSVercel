(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1758],{71941:function(e,s,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/customers",function(){return i(14220)}])},14220:function(e,s,i){"use strict";i.r(s),i.d(s,{default:function(){return customers}});var d=i(52322),r=i(2784),l=i(33766),t=i(18309),a=i(95775),o=i(56958),n=i(41742),customers_CustomerList=e=>{let{onEditCustomer:s,refreshTrigger:i}=e,[l,u]=(0,r.useState)([]),[c,m]=(0,r.useState)(!0),[v,h]=(0,r.useState)({page:1,limit:10,total:0,pages:0}),{get:x,del:g}=(0,a.h)(),fetchCustomers=async()=>{try{let e=await x("/api/customers?page=".concat(v.page,"&limit=").concat(v.limit));u(e.data),h(e.pagination)}catch(e){o.Am.error((null==e?void 0:e.message)||"Failed to load customers")}finally{m(!1)}};(0,r.useEffect)(()=>{fetchCustomers()},[v.page,v.limit,i]);let handleDelete=async e=>{if(confirm("Are you sure you want to delete this customer?"))try{await g("/api/customers/".concat(e)),o.Am.success("Customer deleted successfully \uD83D\uDDD1️"),fetchCustomers()}catch(e){o.Am.error((null==e?void 0:e.message)||"Failed to delete customer ❌")}},p=[{key:"name",header:"Name",render:(e,s)=>(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold",children:e.charAt(0)}),(0,d.jsxs)("div",{className:"ml-4",children:[(0,d.jsx)("div",{className:"font-medium text-gray-900",children:e}),(0,d.jsx)("div",{className:"text-sm text-gray-500",children:s.email})]})]})},{key:"phone",header:"Phone"},{key:"createdAt",header:"Joined",render:e=>new Date(e).toLocaleDateString()},{key:"actions",header:"Actions",render:(e,i)=>(0,d.jsxs)("div",{className:"flex space-x-3",children:[(0,d.jsx)("button",{onClick:()=>s(i),className:"text-blue-600 hover:text-blue-900 font-medium",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>handleDelete(i.id),className:"text-red-600 hover:text-red-900 font-medium",children:"Delete"})]})}];return c?(0,d.jsx)("div",{children:"Loading customers..."}):(0,d.jsxs)("div",{children:[(0,d.jsx)(t.i,{columns:p,data:l,emptyMessage:"No customers found"}),v.pages>1&&(0,d.jsx)(n.t,{currentPage:v.page,totalPages:v.pages,onPageChange:e=>{h(s=>({...s,page:e}))}})]})},u=i(63955),c=i(88883),m=i(48359),v=i(50502),h=i(16813);let x=m.Ry({name:m.Z_().min(1,"Name is required"),email:m.Z_().email("Invalid email address"),phone:m.Z_().optional(),address:m.Ry({line1:m.Z_().min(1,"Address is required"),city:m.Z_().min(1,"City is required"),state:m.Z_().min(1,"State is required"),pincode:m.Z_().min(6,"Pincode is required"),country:m.Z_().min(1,"Country is required")}),taxId:m.Z_().optional()});var customers_CustomerForm=e=>{var s,i,l,t,n,m,g,p,f,y,b,j,C,A;let{customer:N,onSuccess:_,onCancel:I,onRefresh:w}=e,{post:q,put:E,del:S}=(0,a.h)(),{register:k,handleSubmit:D,formState:{errors:Z,isSubmitting:F},reset:P}=(0,u.cI)({resolver:(0,c.F)(x),defaultValues:{address:{country:"India"}}});(0,r.useEffect)(()=>{if(N){var e,s,i,d,r;P({name:N.name,email:N.email,phone:N.phone||"",taxId:N.gstin||N.pan||"",address:{line1:(null===(e=N.billingAddress)||void 0===e?void 0:e.line1)||"",city:(null===(s=N.billingAddress)||void 0===s?void 0:s.city)||"",state:(null===(i=N.billingAddress)||void 0===i?void 0:i.state)||"",pincode:(null===(d=N.billingAddress)||void 0===d?void 0:d.pincode)||"",country:(null===(r=N.billingAddress)||void 0===r?void 0:r.country)||"India"}})}},[N,P]);let handleApiError=(e,s)=>{var i,d;(null==e?void 0:null===(i=e.message)||void 0===i?void 0:i.includes("fails to match"))||(null==e?void 0:null===(d=e.message)||void 0===d?void 0:d.includes("is required"))?e.message.split(",").forEach(e=>o.Am.error(e.trim())):o.Am.error((null==e?void 0:e.message)||s)},onSubmit=async e=>{try{let s={name:e.name,email:e.email,phone:e.phone,gstin:e.taxId,address:e.address};(null==N?void 0:N.id)?(await E("/api/customers/".concat(N.id),s),o.Am.success("Customer updated successfully ✅")):(await q("/api/customers",s),o.Am.success("Customer created successfully ✅")),w(),_()}catch(s){let e=(null==s?void 0:s.message)||"Failed to save customer";handleApiError(s,e)}};return(0,d.jsxs)("form",{onSubmit:D(onSubmit),className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(h.I,{label:"Name",...k("name"),error:null===(s=Z.name)||void 0===s?void 0:s.message,disabled:F,required:!0}),(0,d.jsx)(h.I,{label:"Email",type:"email",...k("email"),error:null===(i=Z.email)||void 0===i?void 0:i.message,disabled:F,required:!0})]}),(0,d.jsx)(h.I,{label:"Phone (e.g., 9876543210)",...k("phone"),error:null===(l=Z.phone)||void 0===l?void 0:l.message,disabled:F}),(0,d.jsx)(h.I,{label:"Tax ID (e.g., 22AAAAA0000A1Z5)",...k("taxId"),error:null===(t=Z.taxId)||void 0===t?void 0:t.message,disabled:F}),(0,d.jsxs)("div",{className:"border-t pt-4",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,d.jsx)(h.I,{label:"Address Line 1",...k("address.line1"),error:null===(m=Z.address)||void 0===m?void 0:null===(n=m.line1)||void 0===n?void 0:n.message,disabled:F,required:!0}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,d.jsx)(h.I,{label:"City",...k("address.city"),error:null===(p=Z.address)||void 0===p?void 0:null===(g=p.city)||void 0===g?void 0:g.message,disabled:F,required:!0}),(0,d.jsx)(h.I,{label:"State",...k("address.state"),error:null===(y=Z.address)||void 0===y?void 0:null===(f=y.state)||void 0===f?void 0:f.message,disabled:F,required:!0}),(0,d.jsx)(h.I,{label:"Pincode (e.g., 560001)",...k("address.pincode"),error:null===(j=Z.address)||void 0===j?void 0:null===(b=j.pincode)||void 0===b?void 0:b.message,disabled:F,required:!0}),(0,d.jsx)(h.I,{label:"Country",...k("address.country"),error:null===(A=Z.address)||void 0===A?void 0:null===(C=A.country)||void 0===C?void 0:C.message,disabled:F,required:!0})]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,d.jsx)(v.z,{type:"button",variant:"outline",onClick:I,disabled:F,children:"Cancel"}),(0,d.jsx)(v.z,{type:"submit",isLoading:F,children:N?"Update Customer":"Create Customer"})]})]})},g=i(7050),customers=()=>{let[e,s]=(0,r.useState)(!1),[i,t]=(0,r.useState)(null),[a,o]=(0,r.useState)(0),handleCloseForm=()=>{s(!1),t(null)};return(0,d.jsx)(l.Z,{children:(0,d.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Customers"}),(0,d.jsx)(v.z,{onClick:()=>s(!0),children:"Add Customer"})]}),(0,d.jsx)(customers_CustomerList,{onEditCustomer:e=>{t(e),s(!0)},refreshTrigger:a}),(0,d.jsx)(g.u,{isOpen:e,onClose:handleCloseForm,title:i?"Edit Customer":"Add Customer",size:"lg",children:(0,d.jsx)(customers_CustomerForm,{customer:i||void 0,onSuccess:()=>{handleCloseForm()},onCancel:handleCloseForm,onRefresh:()=>{o(e=>e+1)}})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=71941)}),_N_E=e.O()}]);