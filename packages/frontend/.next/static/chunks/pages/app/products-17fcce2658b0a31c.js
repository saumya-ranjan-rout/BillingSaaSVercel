(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8902],{73194:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/products",function(){return s(21930)}])},21930:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return products}});var a=s(52322),l=s(2784),r=s(33766),i=s(18309),c=s(95775),d=s(56958),o=s(41742),n=s(65823),u=s(75753),products_ProductList=e=>{let{onEditProduct:t}=e,[s,r]=(0,l.useState)([]),[m,g]=(0,l.useState)([]),[h,x]=(0,l.useState)(!0),[y,v]=(0,l.useState)({categoryId:"",type:"",stockStatus:"",isActive:""}),[p,j]=(0,l.useState)({page:1,limit:10,total:0,pages:0}),{get:b,del:k}=(0,c.h)(),N=(0,l.useCallback)(async()=>{try{let e=new URLSearchParams({page:p.page.toString(),limit:p.limit.toString(),...y.categoryId&&{categoryId:y.categoryId},...y.type&&{type:y.type},...y.stockStatus&&{stockStatus:y.stockStatus},...y.isActive&&{isActive:y.isActive}}),t=await b("/api/products?".concat(e));r(t.data),j(t.pagination)}catch(e){d.Am.error((null==e?void 0:e.message)||"Failed to load products")}finally{x(!1)}},[b,p.page,p.limit,y]);(0,l.useEffect)(()=>{let fetchCategories=async()=>{try{let e=await b("/api/products/categories?limit=100");g(e.data)}catch(e){}};fetchCategories()},[b]),(0,l.useEffect)(()=>{N()},[N]);let handleDelete=async e=>{if(confirm("Are you sure you want to delete this product?"))try{await k("/api/products/".concat(e)),d.Am.success("Product deleted successfully \uD83D\uDDD1️")}catch(e){d.Am.error((null==e?void 0:e.message)||"Failed to delete product ❌")}},handleFilterChange=(e,t)=>{let s="all"===t?"":t;v(t=>({...t,[e]:s})),j(e=>({...e,page:1}))},getStockStatusBadge=e=>{let t={in_stock:{variant:"success",label:"In Stock"},low_stock:{variant:"warning",label:"Low Stock"},out_of_stock:{variant:"destructive",label:"Out of Stock"},discontinued:{variant:"secondary",label:"Discontinued"}}[e]||{variant:"secondary",label:e};return(0,a.jsx)(n.C,{variant:t.variant,children:t.label})},getTypeBadge=e=>{let t={goods:{variant:"info",label:"Goods"},service:{variant:"primary",label:"Service"},digital:{variant:"success",label:"Digital"}}[e]||{variant:"secondary",label:e};return(0,a.jsx)(n.C,{variant:t.variant,children:t.label})},f=[{key:"name",header:"Product",render:(e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:t.sku})]})},{key:"category",header:"Category",render:(e,t)=>{var s;return(0,a.jsx)("span",{className:"text-sm text-gray-600",children:(null===(s=t.category)||void 0===s?void 0:s.name)||"No Category"})}},{key:"type",header:"Type",render:e=>getTypeBadge(e)},{key:"stockStatus",header:"Stock Status",render:(e,t)=>(0,a.jsxs)("div",{children:[getStockStatusBadge(e),"goods"===t.type&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[t.stockQuantity," ",t.unit||"units"]})]})},{key:"sellingPrice",header:"Price",render:e=>"₹".concat(e.toLocaleString())},{key:"isActive",header:"Status",render:e=>(0,a.jsx)(n.C,{variant:e?"success":"outline",children:e?"Active":"Inactive"})},{key:"actions",header:"Actions",render:(e,s)=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>t(s),className:"text-blue-600 hover:text-blue-900 font-medium mr-3",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>handleDelete(s.id),className:"text-red-600 hover:text-red-900 font-medium",children:"Delete"})]})}];return h?(0,a.jsx)("div",{children:"Loading products..."}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,a.jsxs)(u.Ph,{value:y.categoryId||"all",onValueChange:e=>handleFilterChange("categoryId",e),children:[(0,a.jsx)(u.i4,{children:(0,a.jsx)(u.ki,{placeholder:"All Categories"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"all",children:"All Categories"}),m.map(e=>(0,a.jsx)(u.Ql,{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),(0,a.jsxs)(u.Ph,{value:y.type||"all",onValueChange:e=>handleFilterChange("type",e),children:[(0,a.jsx)(u.i4,{children:(0,a.jsx)(u.ki,{placeholder:"All Types"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"all",children:"All Types"}),(0,a.jsx)(u.Ql,{value:"goods",children:"Goods"}),(0,a.jsx)(u.Ql,{value:"service",children:"Service"}),(0,a.jsx)(u.Ql,{value:"digital",children:"Digital"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),(0,a.jsxs)(u.Ph,{value:y.stockStatus||"all",onValueChange:e=>handleFilterChange("stockStatus",e),children:[(0,a.jsx)(u.i4,{children:(0,a.jsx)(u.ki,{placeholder:"All Status"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"all",children:"All Status"}),(0,a.jsx)(u.Ql,{value:"in_stock",children:"In Stock"}),(0,a.jsx)(u.Ql,{value:"low_stock",children:"Low Stock"}),(0,a.jsx)(u.Ql,{value:"out_of_stock",children:"Out of Stock"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Active Status"}),(0,a.jsxs)(u.Ph,{value:y.isActive||"all",onValueChange:e=>handleFilterChange("isActive",e),children:[(0,a.jsx)(u.i4,{children:(0,a.jsx)(u.ki,{placeholder:"All Status"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"all",children:"All Status"}),(0,a.jsx)(u.Ql,{value:"true",children:"Active"}),(0,a.jsx)(u.Ql,{value:"false",children:"Inactive"})]})]})]})]}),(0,a.jsx)(i.i,{columns:f,data:s,emptyMessage:"No products found"}),p.pages>1&&(0,a.jsx)(o.t,{currentPage:p.page,totalPages:p.pages,onPageChange:e=>{j(t=>({...t,page:e}))}})]})},m=s(63955),g=s(88883),h=s(48359),x=s(50502),y=s(16813);let v=h.Ry({name:h.Z_().min(1,"Name is required"),description:h.Z_().optional(),type:h.G0([h.i0(""),h.Km(["goods","service","digital"])]).refine(e=>""!==e,{message:"Product Type is required"}),sku:h.Z_().optional(),hsnCode:h.Z_().optional(),costPrice:h.Rx().min(0,"Cost price must be positive"),sellingPrice:h.Rx().min(0,"Selling price must be positive"),stockQuantity:h.Rx().min(0).default(0),lowStockThreshold:h.Rx().min(0).default(0),unit:h.Z_().optional(),taxRate:h.Rx().min(0).max(100).default(0),categoryId:h.Z_().optional(),categoryName:h.Z_().optional(),isActive:h.O7().default(!0)});var products_ProductForm=e=>{var t,s,r,i,o,n,h,p,j,b,k,N;let{product:f,onSuccess:S,onCancel:C}=e,[P,A]=(0,l.useState)([]),[w,I]=(0,l.useState)(!0),[_,Q]=(0,l.useState)(!1),{post:T,put:F,get:R}=(0,c.h)(),{register:D,handleSubmit:E,control:B,formState:{errors:L,isSubmitting:Z},setValue:q,reset:V,watch:O}=(0,m.cI)({resolver:(0,g.F)(v),defaultValues:{type:"",categoryId:"",categoryName:"",costPrice:0,sellingPrice:0,stockQuantity:0,lowStockThreshold:0,taxRate:0,isActive:!0}}),z=O("type"),G=O("categoryId");O("categoryName"),(0,l.useEffect)(()=>{let fetchCategories=async()=>{try{let e=await R("/api/products/categories?limit=100"),t=Array.isArray(e)?e:Array.isArray(null==e?void 0:e.data)?e.data:[];A(t)}catch(e){d.Am.error((null==e?void 0:e.message)||"Failed to load categories")}finally{I(!1)}};fetchCategories()},[R]),(0,l.useEffect)(()=>{f&&V({name:f.name,description:f.description||"",type:f.type,sku:f.sku||"",hsnCode:f.hsnCode||"",costPrice:Number(f.costPrice),sellingPrice:Number(f.sellingPrice),stockQuantity:Number(f.stockQuantity),lowStockThreshold:Number(f.lowStockThreshold),taxRate:Number(f.taxRate),unit:f.unit||"",categoryId:f.categoryId||"",categoryName:"",isActive:f.isActive})},[f,V]);let onSubmit=async e=>{try{let t={...e,..."goods"!==z?{stockQuantity:0,lowStockThreshold:0,unit:""}:{}};if(_&&!e.categoryName){d.Am.error("Please enter a category name or select an existing category");return}if(!_&&!e.categoryId){d.Am.error("Please select a category");return}_||delete t.categoryName,_&&delete t.categoryId,(null==f?void 0:f.id)?(await F("/api/products/".concat(f.id),t),d.Am.success("Product updated successfully")):(await T("/api/products",t),d.Am.success("Product created successfully")),S()}catch(e){d.Am.error((null==e?void 0:e.message)||"Failed to save product")}};return w?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsxs)("form",{onSubmit:E(onSubmit),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[(0,a.jsx)("div",{children:(0,a.jsx)(y.I,{label:"Product Name",...D("name"),error:null===(t=L.name)||void 0===t?void 0:t.message,disabled:Z,required:!0})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Type"}),(0,a.jsxs)(u.Ph,{onValueChange:e=>q("type",e),value:O("type"),children:[(0,a.jsx)(u.i4,{className:"w-full",children:(0,a.jsx)(u.ki,{placeholder:"Select Type"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"goods",children:"Goods"}),(0,a.jsx)(u.Ql,{value:"service",children:"Service"}),(0,a.jsx)(u.Ql,{value:"digital",children:"Digital"})]})]}),L.type&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:L.type.message})]})]}),(0,a.jsx)(y.I,{label:"Description",...D("description"),error:null===(s=L.description)||void 0===s?void 0:s.message,disabled:Z}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(y.I,{label:"SKU",...D("sku"),error:null===(r=L.sku)||void 0===r?void 0:r.message,disabled:Z}),(0,a.jsx)(y.I,{label:"HSN Code",...D("hsnCode"),error:null===(i=L.hsnCode)||void 0===i?void 0:i.message,disabled:Z})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(y.I,{label:"Cost Price (₹)",type:"number",step:"0.01",...D("costPrice",{valueAsNumber:!0}),error:null===(o=L.costPrice)||void 0===o?void 0:o.message,disabled:Z,required:!0}),(0,a.jsx)(y.I,{label:"Selling Price (₹)",type:"number",step:"0.01",...D("sellingPrice",{valueAsNumber:!0}),error:null===(n=L.sellingPrice)||void 0===n?void 0:n.message,disabled:Z,required:!0}),(0,a.jsx)(y.I,{label:"Tax Rate (%)",type:"number",step:"0.01",...D("taxRate",{valueAsNumber:!0}),error:null===(h=L.taxRate)||void 0===h?void 0:h.message,disabled:Z})]}),"goods"===z&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(y.I,{label:"Stock Quantity",type:"number",step:"0.01",...D("stockQuantity",{valueAsNumber:!0}),error:null===(p=L.stockQuantity)||void 0===p?void 0:p.message,disabled:Z,required:!0}),(0,a.jsx)(y.I,{label:"Low Stock Threshold",type:"number",step:"0.01",...D("lowStockThreshold",{valueAsNumber:!0}),error:null===(j=L.lowStockThreshold)||void 0===j?void 0:j.message,disabled:Z}),(0,a.jsx)(y.I,{label:"Unit",...D("unit"),error:null===(b=L.unit)||void 0===b?void 0:b.message,disabled:Z,placeholder:"pcs, kg, units",required:!0})]}),(0,a.jsx)("div",{className:"space-y-2",children:_?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(y.I,{placeholder:"Enter new category name",...D("categoryName"),error:null===(k=L.categoryName)||void 0===k?void 0:k.message,disabled:Z,className:"flex-1"}),(0,a.jsx)(x.z,{type:"button",variant:"outline",onClick:()=>{Q(!1),q("categoryName",""),q("categoryId","")},disabled:Z,children:"Cancel"})]}),L.categoryName&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:null===(N=L.categoryName)||void 0===N?void 0:N.message})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,a.jsxs)(u.Ph,{onValueChange:e=>{"create_new"===e?(Q(!0),q("categoryId","")):(Q(!1),q("categoryId",e)),q("categoryName","")},value:G,children:[(0,a.jsx)(u.i4,{className:"w-full",children:(0,a.jsx)(u.ki,{placeholder:"Select Category"})}),(0,a.jsxs)(u.Bw,{children:[P.map(e=>(0,a.jsx)(u.Ql,{value:e.id,children:e.name},e.id)),(0,a.jsx)(u.Ql,{value:"create_new",children:"+ Create New Category"})]})]}),L.categoryId&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:L.categoryId.message})]})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",...D("isActive"),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,a.jsx)("label",{className:"ml-2 text-sm text-gray-900",children:"Active Product"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)(x.z,{type:"button",variant:"outline",onClick:C,disabled:Z,children:"Cancel"}),(0,a.jsx)(x.z,{type:"submit",isLoading:Z,children:f?"Update Product":"Create Product"})]})]})},p=s(7050),products=()=>{let[e,t]=(0,l.useState)(!1),[s,i]=(0,l.useState)(null),handleCloseForm=()=>{t(!1),i(null)};return(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Products"}),(0,a.jsx)(x.z,{onClick:()=>t(!0),children:"Add Product"})]}),(0,a.jsx)(products_ProductList,{onEditProduct:e=>{i(e),t(!0)}}),(0,a.jsx)(p.u,{isOpen:e,onClose:handleCloseForm,title:s?"Edit Product":"Add Product",size:"lg",children:(0,a.jsx)(products_ProductForm,{product:s,onSuccess:()=>{handleCloseForm(),window.location.reload()},onCancel:handleCloseForm})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=73194)}),_N_E=e.O()}]);