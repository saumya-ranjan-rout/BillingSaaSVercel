(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1758],{71941:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/customers",function(){return t(14220)}])},14220:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return customers}});var i=t(52322),r=t(2784),l=t(33766),a=t(5632),d=t(18309),o=t(95775),n=t(56958),u=t(41742),c=t(78e3),m=t(1505),customers_CustomerList=e=>{let{onEditCustomer:s,refreshTrigger:t}=e,[l,h]=(0,r.useState)([]),[v,g]=(0,r.useState)(!0),[x,p]=(0,r.useState)(null),y=(0,m.TL)(),f=(0,a.useRouter)(),[b,j]=(0,r.useState)({page:1,limit:10,total:0,pages:0}),{get:C,del:A}=(0,o.h)(),{get:N}=(0,o.h)(),{put:w}=(0,o.h)(),fetchCustomers=async()=>{try{let e=await C("/api/customers?page=".concat(b.page,"&limit=").concat(b.limit));h(e.data),j(e.pagination)}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to load customers")}finally{g(!1)}};(0,r.useEffect)(()=>{let fetchUser=async()=>{try{let e=await N("/api/auth/me");p(e.user)}catch(e){}};fetchUser()},[]),(0,r.useEffect)(()=>{fetchCustomers()},[b.page,b.limit,t]);let handleDelete=async e=>{if(confirm("Are you sure you want to delete this customer?"))try{await A("/api/customers/".concat(e)),n.Am.success("Customer deleted successfully \uD83D\uDDD1️"),fetchCustomers()}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to delete customer ❌")}},viewBusiness=async(e,s)=>{if(confirm("Are you sure you want to switch tenant?"))try{let t=await N("/api/customers/switchTenant/".concat(e,"/").concat(s));y((0,c.Dj)({user:t.user,token:t.accessToken})),localStorage.setItem("token",t.accessToken),localStorage.setItem("user",JSON.stringify(t.user)),n.Am.success("Tenant switched successfully \uD83D\uDDD1️"),f.replace("/app/dashboard")}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to switch tenant ❌")}},_=[{key:"name",header:"Name",render:(e,s)=>(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold",children:e.charAt(0)}),(0,i.jsxs)("div",{className:"ml-4",children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:e}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:s.email})]})]})},{key:"phone",header:"Phone"},{key:"createdAt",header:"Joined",render:e=>new Date(e).toLocaleDateString()},{key:"actions",header:"Actions",render:(e,t)=>{var r,l;let a=null;return t.requestedBy&&"professional"!==t.requestedBy.role&&(a=null!==(r=t.requestedBy.tenantId)&&void 0!==r?r:null),t.requestedTo&&"professional"!==t.requestedTo.role&&(a=null!==(l=t.requestedTo.tenantId)&&void 0!==l?l:null),(0,i.jsxs)("div",{className:"flex space-x-3",children:[(0,i.jsx)("button",{onClick:()=>s(t),className:"bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600",children:"Edit"}),(0,i.jsx)("button",{onClick:()=>handleDelete(t.id),className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Delete"}),(null==x?void 0:x.role)==="professional"&&(null==t?void 0:t.checkSubscription)==="active"&&a&&(0,i.jsx)("button",{onClick:()=>viewBusiness(a,"professional_user"),className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600",children:" View Business "})]})}}];return v?(0,i.jsx)("div",{children:"Loading customers..."}):(0,i.jsxs)("div",{children:[(0,i.jsx)(d.i,{columns:_,data:l,emptyMessage:"No customers found"}),b.pages>1&&(0,i.jsx)(u.t,{currentPage:b.page,totalPages:b.pages,onPageChange:e=>{j(s=>({...s,page:e}))}})]})},h=t(63955),v=t(88883),g=t(48359),x=t(50502),p=t(16813);let y=g.Ry({name:g.Z_().min(1,"Name is required"),email:g.Z_().email("Invalid email address"),phone:g.Z_().optional(),address:g.Ry({line1:g.Z_().min(1,"Address is required"),city:g.Z_().min(1,"City is required"),state:g.Z_().min(1,"State is required"),pincode:g.Z_().min(6,"Pincode is required"),country:g.Z_().min(1,"Country is required")}),taxId:g.Z_().optional()});var customers_CustomerForm=e=>{var s,t,l,a,d,u,c,m,g,f,b,j,C,A;let{customer:N,onSuccess:w,onCancel:_,onRefresh:I}=e,{post:q,put:k,del:S}=(0,o.h)(),{register:D,handleSubmit:E,formState:{errors:T,isSubmitting:F},reset:Z}=(0,h.cI)({resolver:(0,v.F)(y),defaultValues:{address:{country:"India"}}});(0,r.useEffect)(()=>{if(N){var e,s,t,i,r;Z({name:N.name,email:N.email,phone:N.phone||"",taxId:N.gstin||N.pan||"",address:{line1:(null===(e=N.billingAddress)||void 0===e?void 0:e.line1)||"",city:(null===(s=N.billingAddress)||void 0===s?void 0:s.city)||"",state:(null===(t=N.billingAddress)||void 0===t?void 0:t.state)||"",pincode:(null===(i=N.billingAddress)||void 0===i?void 0:i.pincode)||"",country:(null===(r=N.billingAddress)||void 0===r?void 0:r.country)||"India"}})}},[N,Z]);let handleApiError=(e,s)=>{var t,i;(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("fails to match"))||(null==e?void 0:null===(i=e.message)||void 0===i?void 0:i.includes("is required"))?e.message.split(",").forEach(e=>n.Am.error(e.trim())):n.Am.error((null==e?void 0:e.message)||s)},onSubmit=async e=>{try{let s={name:e.name,email:e.email,phone:e.phone,gstin:e.taxId,address:e.address};(null==N?void 0:N.id)?(await k("/api/customers/".concat(N.id),s),n.Am.success("Customer updated successfully ✅")):(await q("/api/customers",s),n.Am.success("Customer created successfully ✅")),I(),w()}catch(s){let e=(null==s?void 0:s.message)||"Failed to save customer";handleApiError(s,e)}};return(0,i.jsxs)("form",{onSubmit:E(onSubmit),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsx)(p.I,{label:"Name",...D("name"),error:null===(s=T.name)||void 0===s?void 0:s.message,disabled:F,required:!0}),(0,i.jsx)(p.I,{label:"Email",type:"email",...D("email"),error:null===(t=T.email)||void 0===t?void 0:t.message,disabled:F,required:!0})]}),(0,i.jsx)(p.I,{label:"Phone (e.g., 9876543210)",...D("phone"),error:null===(l=T.phone)||void 0===l?void 0:l.message,disabled:F}),(0,i.jsx)(p.I,{label:"Tax ID (e.g., 22AAAAA0000A1Z5)",...D("taxId"),error:null===(a=T.taxId)||void 0===a?void 0:a.message,disabled:F}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,i.jsx)(p.I,{label:"Address Line 1",...D("address.line1"),error:null===(u=T.address)||void 0===u?void 0:null===(d=u.line1)||void 0===d?void 0:d.message,disabled:F,required:!0}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsx)(p.I,{label:"City",...D("address.city"),error:null===(m=T.address)||void 0===m?void 0:null===(c=m.city)||void 0===c?void 0:c.message,disabled:F,required:!0}),(0,i.jsx)(p.I,{label:"State",...D("address.state"),error:null===(f=T.address)||void 0===f?void 0:null===(g=f.state)||void 0===g?void 0:g.message,disabled:F,required:!0}),(0,i.jsx)(p.I,{label:"Pincode (e.g., 560001)",...D("address.pincode"),error:null===(j=T.address)||void 0===j?void 0:null===(b=j.pincode)||void 0===b?void 0:b.message,disabled:F,required:!0}),(0,i.jsx)(p.I,{label:"Country",...D("address.country"),error:null===(A=T.address)||void 0===A?void 0:null===(C=A.country)||void 0===C?void 0:C.message,disabled:F,required:!0})]})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,i.jsx)(x.z,{type:"button",variant:"outline",onClick:_,disabled:F,children:"Cancel"}),(0,i.jsx)(x.z,{type:"submit",isLoading:F,children:N?"Update Customer":"Create Customer"})]})]})},f=t(7050),customers=()=>{let[e,s]=(0,r.useState)(!1),[t,a]=(0,r.useState)(null),[d,o]=(0,r.useState)(0),handleCloseForm=()=>{s(!1),a(null)};return(0,i.jsx)(l.Z,{children:(0,i.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Customers"}),(0,i.jsx)(x.z,{onClick:()=>s(!0),children:"Add Customer"})]}),(0,i.jsx)(customers_CustomerList,{onEditCustomer:e=>{a(e),s(!0)},refreshTrigger:d}),(0,i.jsx)(f.u,{isOpen:e,onClose:handleCloseForm,title:t?"Edit Customer":"Add Customer",size:"lg",children:(0,i.jsx)(customers_CustomerForm,{customer:t||void 0,onSuccess:()=>{handleCloseForm()},onCancel:handleCloseForm,onRefresh:()=>{o(e=>e+1)}})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=71941)}),_N_E=e.O()}]);