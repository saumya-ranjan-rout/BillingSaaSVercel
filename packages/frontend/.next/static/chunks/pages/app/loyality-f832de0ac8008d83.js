(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4785],{65411:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/loyality",function(){return s(57062)}])},57062:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return loyality}});var t=s(52322),r=s(2784),l=s(33766),i=s(50502),loyalty_CustomerLoyaltyDashboard=e=>{var a;let{loyaltyData:s,onRedeem:r}=e,{summary:l,recentTransactions:n,program:c}=s;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["₹",(null==l?void 0:l.availableCashback)||0]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Available Cashback"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["₹",(null==l?void 0:l.totalCashbackEarned)||0]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total Earned"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:["₹",(null==l?void 0:l.totalAmountSpent)||0]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total Spent"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat({bronze:"bg-amber-100 text-amber-800",silver:"bg-gray-100 text-gray-800",gold:"bg-yellow-100 text-yellow-800",platinum:"bg-blue-100 text-blue-800"}[null==l?void 0:l.currentTier]||"bg-gray-100 text-gray-800"),children:null==l?void 0:null===(a=l.currentTier)||void 0===a?void 0:a.toUpperCase()}),(0,t.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Current Tier"})]})]}),(null==l?void 0:l.availableCashback)>0&&(0,t.jsx)("div",{className:"mt-4 flex justify-center",children:(0,t.jsx)(i.z,{onClick:()=>r(l.availableCashback),variant:"outline",size:"sm",children:"Redeem Cashback"})})]}),c&&(0,t.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-semibold text-blue-900",children:"Current Program"}),(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:[c.cashbackPercentage,"% cashback on purchases above ₹",c.minimumPurchaseAmount]}),c.maximumCashbackAmount&&(0,t.jsxs)("p",{className:"text-xs text-blue-600",children:["Maximum cashback: ₹",c.maximumCashbackAmount," per transaction"]})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("h4",{className:"font-semibold mb-4",children:"Recent Transactions"}),(0,t.jsxs)("div",{className:"space-y-2",children:[null==n?void 0:n.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm",children:e.description}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"font-medium ".concat(e.cashbackAmount>0?"text-green-600":"text-red-600"),children:[e.cashbackAmount>0?"+":"",e.cashbackAmount]})]},e.id)),(!n||0===n.length)&&(0,t.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No transactions yet"})]})]})]})},n=s(63955),c=s(16813),o=s(95775),m=s(56958),d=s(75753),loyalty_LoyaltySettings=e=>{var a,s,l,u,x,h;let{program:y,onUpdate:g}=e,[b,p]=(0,r.useState)(!1),{put:v,get:j}=(0,o.h)(),{register:f,handleSubmit:N,formState:{errors:k},watch:P,setValue:w}=(0,n.cI)({defaultValues:y}),C=P("rewardType");(0,r.useEffect)(()=>{y&&Object.keys(y).forEach(e=>{w(e,y[e])})},[y,w]);let onSubmit=async e=>{if(!(null==y?void 0:y.id)){m.Am.error("Program ID is missing");return}p(!0);try{await v("/api/loyalty/program/".concat(y.id),e),m.Am.success("Loyalty program updated successfully"),g()}catch(e){m.Am.error((null==e?void 0:e.message)||"Failed to update program")}finally{p(!1)}};return(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Loyalty Program Settings"}),(0,t.jsxs)("form",{onSubmit:N(onSubmit),className:"space-y-4",children:[(0,t.jsx)(c.I,{label:"Program Name",...f("name",{required:"Program name is required"}),error:String((null===(a=k.name)||void 0===a?void 0:a.message)||"")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Reward Type"}),(0,t.jsxs)(d.Ph,{value:P("rewardType"),onValueChange:e=>w("rewardType",e),children:[(0,t.jsx)(d.i4,{children:(0,t.jsx)(d.ki,{placeholder:"Select Reward Type"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"cashback",children:"Cashback"}),(0,t.jsx)(d.Ql,{value:"points",children:"Points"}),(0,t.jsx)(d.Ql,{value:"discount",children:"Discount"})]})]})]}),"cashback"===C&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.I,{label:"Cashback Percentage",type:"number",step:"0.1",...f("cashbackPercentage",{required:"Percentage is required",min:{value:0,message:"Percentage must be positive"},max:{value:100,message:"Percentage cannot exceed 100"}}),error:String((null===(s=k.cashbackPercentage)||void 0===s?void 0:s.message)||"")}),(0,t.jsx)(c.I,{label:"Minimum Purchase Amount (₹)",type:"number",...f("minimumPurchaseAmount",{required:"Minimum amount is required",min:{value:0,message:"Amount must be positive"}}),error:String((null===(l=k.minimumPurchaseAmount)||void 0===l?void 0:l.message)||"")}),(0,t.jsx)(c.I,{label:"Maximum Cashback Amount (₹)",type:"number",...f("maximumCashbackAmount",{min:{value:0,message:"Amount must be positive"}}),error:String((null===(u=k.maximumCashbackAmount)||void 0===u?void 0:u.message)||"")})]}),"points"===C&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.I,{label:"Points per ₹100 spent",type:"number",...f("pointsPerUnit",{required:"Points per unit is required",min:{value:1,message:"Must be at least 1 point"}}),error:String((null===(x=k.pointsPerUnit)||void 0===x?void 0:x.message)||"")}),(0,t.jsx)(c.I,{label:"Point Value (₹)",type:"number",step:"0.01",...f("pointValue",{required:"Point value is required",min:{value:.01,message:"Value must be positive"}}),error:String((null===(h=k.pointValue)||void 0===h?void 0:h.message)||"")})]}),(0,t.jsx)(i.z,{type:"submit",isLoading:b,className:"w-full",children:"Update Program"})]})]})},u=s(7050),loyality=()=>{let[e,a]=(0,r.useState)(!1),[s,n]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[y,g]=(0,r.useState)(""),{get:b,post:p}=(0,o.h)();(0,r.useEffect)(()=>{let fetchCustomers=async()=>{try{let e=await b("/api/customers?limit=100");h(e.data||[])}catch(e){m.Am.error(e.message||"Failed to load customers")}};fetchCustomers()},[b]);let fetchLoyaltyData=async e=>{if(e)try{let a=await b("/api/loyalty/customer/".concat(e,"/summary"));a.success?n({summary:a.summary,recentTransactions:a.recentTransactions,program:a.program}):m.Am.error(a.error||"Failed to load loyalty data")}catch(e){m.Am.error(e.message||"Error fetching loyalty data")}},fetchProgram=async()=>{try{let e=await b("/api/loyalty/program");e.success?d(e.program):m.Am.error(e.error||"Failed to load program")}catch(e){m.Am.error(e.message||"Error fetching program")}};(0,r.useEffect)(()=>{y&&fetchLoyaltyData(y)},[y]);let handleRedeem=async e=>{try{let a=await p("/api/loyalty/redeem-cashback",{customerId:y,amount:e});a.success?(m.Am.success("Redeemed ₹".concat(e)),fetchLoyaltyData(y)):m.Am.error(a.error||"Redeem failed")}catch(e){m.Am.error(e.message||"Redeem failed")}};return(0,t.jsx)(l.Z,{children:(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Loyalty Program"}),(0,t.jsx)(i.z,{onClick:()=>{fetchProgram(),a(!0)},children:"Program Settings"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Customer"}),(0,t.jsxs)("select",{value:y,onChange:e=>g(e.target.value),className:"border rounded-lg px-3 py-2 w-full",children:[(0,t.jsx)("option",{value:"",children:"-- Choose Customer --"}),x.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),s?(0,t.jsx)(loyalty_CustomerLoyaltyDashboard,{loyaltyData:s,onRedeem:handleRedeem}):(0,t.jsx)("div",{className:"text-gray-500",children:y?"Loading loyalty data...":"Please select a customer to view loyalty details"}),(0,t.jsx)(u.u,{isOpen:e,onClose:()=>a(!1),title:"Loyalty Program Settings",size:"xl",children:c?(0,t.jsx)(loyalty_LoyaltySettings,{program:c,onUpdate:()=>{fetchProgram(),a(!1)}}):(0,t.jsx)("div",{className:"text-gray-500",children:"Loading program..."})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=65411)}),_N_E=e.O()}]);