(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7401],{30516:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/professional-requests",function(){return t(17832)}])},17832:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return professional_requests}});var a=t(52322),r=t(2784),l=t(33766),i=t(95775),n=t(56958),o=t(18309),d=t(65823),u=t(41742),professionalRequests_ProfessionalRequestList=()=>{let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[p,f]=(0,r.useState)({status:""}),[h,v]=(0,r.useState)({page:1,limit:10,total:0,pages:0}),{get:x,patch:g}=(0,i.h)(),y=(0,r.useCallback)(async()=>{try{let e=new URLSearchParams({page:h.page.toString(),limit:h.limit.toString(),...p.status&&{status:p.status}}),t=await x("/api/professional-requests?".concat(e));s(t||[]),t.pagination&&v(t.pagination)}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to load requests")}finally{l(!1)}},[x,h.page,h.limit,p.status]);(0,r.useEffect)(()=>{let fetchUser=async()=>{try{let e=await x("/api/auth/me");m(e.user)}catch(e){}};fetchUser()},[]),(0,r.useEffect)(()=>{y()},[p.status,h.page,h.limit]);let updateStatus=async(e,s)=>{try{await g("/api/professional-requests/".concat(e,"/status"),{status:s}),n.Am.success("Request ".concat(s," successfully ✅")),y()}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to update status ❌")}},getStatusBadge=e=>{let s={Pending:{variant:"warning",label:"Pending"},Approved:{variant:"success",label:"Approved"},Rejected:{variant:"destructive",label:"Rejected"}}[e]||{variant:"secondary",label:e};return(0,a.jsx)(d.C,{variant:s.variant,children:s.label})},j=[{key:"name",header:"Customer",render:(e,s)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:s.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:s.email})]})},{key:"requestedBy",header:"Requested By",render:(e,s)=>{var t,r,l,i;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-gray-900",children:[null===(t=s.requestedBy)||void 0===t?void 0:t.firstName," ",null===(r=s.requestedBy)||void 0===r?void 0:r.lastName]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:(null===(l=s.requestedBy)||void 0===l?void 0:l.role)==="admin"?"business user":"".concat(null===(i=s.requestedBy)||void 0===i?void 0:i.role," user")})]})}},{key:"requestedTo",header:"Requested To",render:(e,s)=>{var t,r,l,i;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-gray-900",children:[null===(t=s.requestedTo)||void 0===t?void 0:t.firstName," ",null===(r=s.requestedTo)||void 0===r?void 0:r.lastName]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:(null===(l=s.requestedTo)||void 0===l?void 0:l.role)==="admin"?"business user":"".concat(null===(i=s.requestedTo)||void 0===i?void 0:i.role," user")})]})}},{key:"status",header:"Status",render:e=>getStatusBadge(e||"Pending")},{key:"actions",header:"Actions",render:(e,s)=>{var t;return"Rejected"===s.status?null:(0,a.jsxs)("div",{className:"flex gap-2",children:[(null==c?void 0:c.id)!==(null===(t=s.requestedBy)||void 0===t?void 0:t.id)&&(0,a.jsx)("button",{onClick:()=>updateStatus(s.id,"Approved"),className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600",children:"Approve"}),(0,a.jsx)("button",{onClick:()=>updateStatus(s.id,"Rejected"),className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Reject"})]})}}];return t?(0,a.jsx)("div",{children:"Loading requests..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)(o.i,{columns:j,data:e.filter(e=>e.name),emptyMessage:"No requests found"}),h.pages>1&&(0,a.jsx)(u.t,{currentPage:h.page,totalPages:h.pages,onPageChange:e=>v(s=>({...s,page:e}))})]})},c=t(63955),m=t(88883),p=t(48359),f=t(50502),h=t(75753),v=t(16813);let x=p.Ry({professionalId:p.Z_().min(1,"Please select a professional")});var professionalRequests_ProfessionalRequestForm=()=>{let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(""),[o,d]=(0,r.useState)(!0),{get:u,post:p}=(0,i.h)(),{handleSubmit:g,setValue:y,watch:j,formState:{errors:q,isSubmitting:N}}=(0,c.cI)({resolver:(0,m.F)(x),defaultValues:{professionalId:""}});(0,r.useEffect)(()=>{let fetchProfessionals=async()=>{try{let e=await u("/api/professional-requests/professionals"),t=Array.isArray(e)?e:Array.isArray(null==e?void 0:e.data)?e.data:[];s(t)}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to load professionals")}finally{d(!1)}};fetchProfessionals()},[u]);let onSubmit=async e=>{try{await p("/api/professional-requests",{requestedId:e.professionalId}),n.Am.success("Request sent successfully!"),y("professionalId",""),l(""),setTimeout(()=>{window.location.reload()},1e3)}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to send request")}};if(o)return(0,a.jsx)("div",{children:"Loading..."});let b=e.filter(e=>{var s;let a="".concat(e.firstName," ").concat(e.lastName).toLowerCase(),r=(null===(s=e.email)||void 0===s?void 0:s.toLowerCase())||"";return a.includes(t.toLowerCase())||r.includes(t.toLowerCase())});return(0,a.jsxs)("form",{onSubmit:g(onSubmit),className:"space-y-4 bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Professional *"}),(0,a.jsxs)(h.Ph,{onValueChange:e=>y("professionalId",e),value:j("professionalId"),children:[(0,a.jsx)(h.i4,{className:"w-full",children:(0,a.jsx)(h.ki,{placeholder:"Search or select a professional..."})}),(0,a.jsxs)(h.Bw,{className:"max-h-64 overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-2 sticky top-0 bg-white z-10 border-b",children:(0,a.jsx)(v.I,{placeholder:"Type to search...",value:t,onChange:e=>l(e.target.value),className:"text-sm"})}),b.length>0?b.map(e=>(0,a.jsxs)(h.Ql,{value:e.id,children:[e.firstName," ",e.lastName," (",e.email,")"]},e.id)):(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No professionals found"})]})]}),q.professionalId&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:q.professionalId.message})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-3 pt-4",children:(0,a.jsx)(f.z,{type:"submit",isLoading:N,children:"Send Request"})})]})},professional_requests=()=>(0,a.jsx)(l.Z,{children:(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:"Professional Requests"}),(0,a.jsx)(professionalRequests_ProfessionalRequestForm,{}),(0,a.jsx)(professionalRequests_ProfessionalRequestList,{})]})})}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=30516)}),_N_E=e.O()}]);