(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2716],{31076:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/purchases",function(){return s(27741)}])},27741:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return purchases}});var a=s(52322),i=s(2784),r=s(33766),d=s(18309),l=s(95775),n=s(56958),o=s(41742),c=s(65823),u=s(50502),purchases_PurchaseList=e=>{let{onEditPurchase:t}=e,[s,r]=(0,i.useState)([]),[m,p]=(0,i.useState)(!0),[v,x]=(0,i.useState)({page:1,limit:10,total:0,pages:0}),{get:h,del:g}=(0,l.h)(),fetchPurchaseOrders=async()=>{try{let e=await h("/api/purchases?page=".concat(v.page,"&limit=").concat(v.limit));r(e.data),x(e.pagination)}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to load purchase orders")}finally{p(!1)}};(0,i.useEffect)(()=>{fetchPurchaseOrders()},[v.page,v.limit]);let handleDelete=async e=>{if(confirm("Are you sure you want to delete this purchase order?"))try{await g("/api/purchases/".concat(e)),n.Am.success("Purchase order deleted successfully \uD83D\uDDD1️"),fetchPurchaseOrders()}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to delete Purchase order ❌")}},getStatusBadge=e=>{let t={draft:{label:"Draft",variant:"outline"},pending:{label:"Pending",variant:"warning"},approved:{label:"Approved",variant:"success"},ordered:{label:"Ordered",variant:"default"},received:{label:"Received",variant:"success"},cancelled:{label:"Cancelled",variant:"danger"},paid:{label:"Paid",variant:"success"}}[e]||{label:e,variant:"default"};return(0,a.jsx)(c.C,{variant:t.variant,children:t.label})},b=[{key:"poNumber",header:"PO Number",render:(e,t)=>{var s;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:null===(s=t.vendor)||void 0===s?void 0:s.name})]})}},{key:"orderDate",header:"Order Date",render:e=>new Date(e).toLocaleDateString()},{key:"status",header:"Status",render:e=>getStatusBadge(e)},{key:"totalAmount",header:"Total Amount",render:e=>"₹".concat(e.toLocaleString())},{key:"balanceDue",header:"Balance Due",render:e=>(0,a.jsxs)("span",{className:e>0?"text-red-600 font-medium":"text-green-600",children:["₹",e.toLocaleString()]})},{key:"actions",header:"Actions",render:(e,s)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u.z,{onClick:()=>t(s),variant:"outline",size:"sm",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>handleDelete(s.id),className:"text-red-600 hover:text-red-900 font-medium text-sm",children:"Delete"})]})}];return m?(0,a.jsx)("div",{children:"Loading purchase orders..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)(d.i,{columns:b,data:s,emptyMessage:"No purchase orders found"}),v.pages>1&&(0,a.jsx)(o.t,{currentPage:v.page,totalPages:v.pages,onPageChange:e=>{x(t=>({...t,page:e}))}})]})},m=s(63955),p=s(88883),v=s(48359),x=s(16813),h=s(75753);let SelectWrapper=e=>{let{label:t,value:s,onChange:i,options:r,placeholder:d="Select an option"}=e;return(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[t&&(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t}),(0,a.jsxs)(h.Ph,{value:s,onValueChange:e=>null==i?void 0:i(e),children:[(0,a.jsx)(h.i4,{children:(0,a.jsx)(h.ki,{placeholder:d})}),(0,a.jsx)(h.Bw,{children:r.map(e=>(0,a.jsx)(h.Ql,{value:e.value,children:e.label},e.value))})]})]})};var g=s(78255),b=s(18347);let y=v.Ry({productId:v.Z_().min(1,"Product is required"),description:v.Z_().min(1,"Description is required"),quantity:v.Rx().min(1,"Quantity is required"),unit:v.Z_().min(1,"Unit is required"),unitPrice:v.Rx().min(.01,"Unit Price is required"),discount:v.Rx().min(0).max(100).default(0),taxRate:v.Rx().min(0).max(100).default(0),tenantId:v.Z_().optional()}),j=v.Ry({vendorId:v.Z_().min(1,"Vendor is required"),type:v.Km(["product","service","expense"],{required_error:"Type is required",invalid_type_error:"Type is required"}),orderDate:v.Z_().min(1,"Order Date is required"),expectedDeliveryDate:v.Z_().optional(),shippingAddress:v.Z_().optional(),billingAddress:v.Z_().optional(),termsAndConditions:v.Z_().optional(),notes:v.Z_().optional(),items:v.IX(y).min(1,"At least one item is required")});var purchases_PurchaseForm=e=>{var t,s,r,d,o,c;let v,h,y;let{purchaseOrder:f,onSuccess:N,onCancel:D}=e,[A,P]=(0,i.useState)([]),[I,S]=(0,i.useState)([]),[C,_]=(0,i.useState)(!0),w=(0,l.h)(),q=(0,l.h)(),O=(0,l.h)(),{register:T,handleSubmit:R,formState:{errors:k,isSubmitting:F},reset:E,control:Z,watch:z,setValue:L}=(0,m.cI)({resolver:(0,p.F)(j),defaultValues:{type:void 0,vendorId:"",orderDate:new Date().toISOString().split("T")[0],items:[{productId:"",description:"",quantity:1,unit:"pcs",unitPrice:0,discount:0,taxRate:0}]}}),{fields:B,append:U,remove:V}=(0,m.Dq)({control:Z,name:"items"}),W=z("items");(0,i.useEffect)(()=>{let fetchData=async()=>{try{let[e,t]=await Promise.all([q.get("/api/vendors?limit=100"),O.get("/api/products?limit=100")]),s=Array.isArray(e)?e:Array.isArray(null==e?void 0:e.data)?e.data:[],a=Array.isArray(t)?t:Array.isArray(null==t?void 0:t.data)?t.data:[];P(s),S(a)}catch(e){n.Am.error("Failed to load form data")}finally{_(!1)}};fetchData()},[]),(0,i.useEffect)(()=>{if(f){var e;E({vendorId:f.vendorId||"",type:f.type,orderDate:f.orderDate.split("T")[0],expectedDeliveryDate:null===(e=f.expectedDeliveryDate)||void 0===e?void 0:e.split("T")[0],shippingAddress:f.shippingAddress,billingAddress:f.billingAddress,termsAndConditions:f.termsAndConditions,notes:f.notes,items:f.items.map(e=>{var t,s;return{productId:null!==(t=e.productId)&&void 0!==t?t:"",description:e.description,quantity:Number(e.quantity)||1,unit:null!==(s=e.unit)&&void 0!==s?s:"pcs",unitPrice:Number(e.unitPrice)||0,discount:Number(e.discount)||0,taxRate:Number(e.taxRate)||0}})})}},[f,E]);let calculateItemTotals=e=>{let t=e.unitPrice*e.quantity*e.discount/100,s=e.unitPrice*e.quantity-t,a=s*e.taxRate/100;return{discountAmount:t,taxAmount:a,lineTotal:s+a}},handleProductChange=(e,t)=>{let s=I.find(e=>e.id===t);s&&(L("items.".concat(e,".productId"),s.id),L("items.".concat(e,".description"),s.name),L("items.".concat(e,".unitPrice"),s.costPrice),L("items.".concat(e,".unit"),s.unit||"pcs"),L("items.".concat(e,".taxRate"),s.taxRate||0))},onSubmit=async e=>{try{let t={...e,orderDate:new Date(e.orderDate).toISOString(),expectedDeliveryDate:e.expectedDeliveryDate?new Date(e.expectedDeliveryDate).toISOString():void 0};(null==f?void 0:f.id)?(await w.put("/api/purchases/".concat(f.id),t),n.Am.success("Purchase order updated successfully")):(await w.post("/api/purchases",t),n.Am.success("Purchase order created successfully")),N()}catch(e){n.Am.error((null==e?void 0:e.message)||"Failed to save purchase order")}};if(C)return(0,a.jsx)("div",{children:"Loading..."});let Q=(v=0,h=0,y=0,W.forEach(e=>{let t=calculateItemTotals(e);v+=e.unitPrice*e.quantity,y+=t.discountAmount,h+=t.taxAmount}),{subTotal:v,taxTotal:h,discountTotal:y,totalAmount:v-y+h});return(0,a.jsxs)("form",{onSubmit:R(onSubmit),className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)(SelectWrapper,{label:"Vendor",value:z("vendorId"),onChange:e=>L("vendorId",e),options:A.map(e=>({value:e.id,label:e.name}))}),k.vendorId&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:k.vendorId.message})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)(SelectWrapper,{label:"Type",value:z("type"),onChange:e=>L("type",e),options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"expense",label:"Expense"}]}),k.type&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:k.type.message})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)(x.I,{label:"Order Date",type:"date",...T("orderDate"),error:null===(t=k.orderDate)||void 0===t?void 0:t.message,disabled:F})}),(0,a.jsx)(x.I,{label:"Expected Delivery Date",type:"date",...T("expectedDeliveryDate"),error:null===(s=k.expectedDeliveryDate)||void 0===s?void 0:s.message,disabled:F})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Items"}),B.map((e,t)=>{var s,i,r,d,l,n,o,c,m,p,v,h,b,y,j,f,N,D,A,P,S,C;return(0,a.jsxs)("div",{className:"border rounded-lg p-4 mb-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[(0,a.jsxs)("div",{className:"md:col-span-4 flex flex-col",children:[(0,a.jsx)(SelectWrapper,{label:"Product",value:z("items.".concat(t,".productId")),onChange:e=>{L("items.".concat(t,".productId"),e),handleProductChange(t,e)},options:I.map(e=>({value:e.id,label:e.name}))}),(null===(i=k.items)||void 0===i?void 0:null===(s=i[t])||void 0===s?void 0:s.productId)&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:null===(d=k.items[t])||void 0===d?void 0:null===(r=d.productId)||void 0===r?void 0:r.message})]}),(0,a.jsx)("div",{className:"md:col-span-4",children:(0,a.jsx)(x.I,{label:"Description",...T("items.".concat(t,".description")),error:null===(o=k.items)||void 0===o?void 0:null===(n=o[t])||void 0===n?void 0:null===(l=n.description)||void 0===l?void 0:l.message,disabled:F})}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(x.I,{label:"Quantity",type:"number",step:"0.01",...T("items.".concat(t,".quantity"),{valueAsNumber:!0}),error:null===(p=k.items)||void 0===p?void 0:null===(m=p[t])||void 0===m?void 0:null===(c=m.quantity)||void 0===c?void 0:c.message,disabled:F})}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(x.I,{label:"Unit",...T("items.".concat(t,".unit")),error:null===(b=k.items)||void 0===b?void 0:null===(h=b[t])||void 0===h?void 0:null===(v=h.unit)||void 0===v?void 0:v.message,disabled:F})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 mt-4",children:[(0,a.jsx)("div",{className:"md:col-span-3",children:(0,a.jsx)(x.I,{label:"Unit Price (₹)",type:"number",step:"0.01",...T("items.".concat(t,".unitPrice"),{valueAsNumber:!0}),error:null===(f=k.items)||void 0===f?void 0:null===(j=f[t])||void 0===j?void 0:null===(y=j.unitPrice)||void 0===y?void 0:y.message,disabled:F})}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(x.I,{label:"Discount (%)",type:"number",step:"0.01",...T("items.".concat(t,".discount"),{valueAsNumber:!0}),error:null===(A=k.items)||void 0===A?void 0:null===(D=A[t])||void 0===D?void 0:null===(N=D.discount)||void 0===N?void 0:N.message,disabled:F})}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(x.I,{label:"Tax Rate (%)",type:"number",step:"0.01",...T("items.".concat(t,".taxRate"),{valueAsNumber:!0}),error:null===(C=k.items)||void 0===C?void 0:null===(S=C[t])||void 0===S?void 0:null===(P=S.taxRate)||void 0===P?void 0:P.message,disabled:F})}),(0,a.jsx)("div",{className:"md:col-span-3",children:(0,a.jsx)(x.I,{label:"Line Total (₹)",type:"number",value:calculateItemTotals(W[t]).lineTotal.toFixed(2),disabled:!0,className:"bg-gray-50"})}),(0,a.jsx)("div",{className:"md:col-span-2 flex items-end",children:B.length>1&&(0,a.jsx)(u.z,{type:"button",variant:"danger",onClick:()=>V(t),disabled:F,className:"w-full",children:(0,a.jsx)(g.Z,{size:16})})})]})]},e.id)}),(0,a.jsxs)(u.z,{type:"button",variant:"outline",onClick:()=>U({productId:"",description:"",quantity:1,unit:"pcs",unitPrice:0,discount:0,taxRate:0}),disabled:F,className:"mt-2",children:[(0,a.jsx)(b.Z,{size:16,className:"mr-2"})," Add Item"]})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-md ml-auto",children:[(0,a.jsx)("div",{className:"text-right",children:"Subtotal:"}),(0,a.jsxs)("div",{className:"text-right font-medium",children:["₹",Q.subTotal.toFixed(2)]}),(0,a.jsx)("div",{className:"text-right",children:"Discount:"}),(0,a.jsxs)("div",{className:"text-right font-medium text-red-600",children:["-₹",Q.discountTotal.toFixed(2)]}),(0,a.jsx)("div",{className:"text-right",children:"Tax:"}),(0,a.jsxs)("div",{className:"text-right font-medium",children:["+₹",Q.taxTotal.toFixed(2)]}),(0,a.jsx)("div",{className:"text-right border-t pt-2 font-semibold",children:"Total:"}),(0,a.jsxs)("div",{className:"text-right border-t pt-2 font-semibold",children:["₹",Q.totalAmount.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,a.jsx)(x.I,{label:"Shipping Address",...T("shippingAddress"),error:null===(r=k.shippingAddress)||void 0===r?void 0:r.message,disabled:F}),(0,a.jsx)(x.I,{label:"Billing Address",...T("billingAddress"),error:null===(d=k.billingAddress)||void 0===d?void 0:d.message,disabled:F}),(0,a.jsx)(x.I,{label:"Terms & Conditions",...T("termsAndConditions"),error:null===(o=k.termsAndConditions)||void 0===o?void 0:o.message,disabled:F}),(0,a.jsx)(x.I,{label:"Notes",...T("notes"),error:null===(c=k.notes)||void 0===c?void 0:c.message,disabled:F})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)(u.z,{type:"button",variant:"outline",onClick:D,disabled:F,children:"Cancel"}),(0,a.jsx)(u.z,{type:"submit",isLoading:F,children:f?"Update Purchase Order":"Create Purchase Order"})]})]})},f=s(7050),purchases=()=>{let[e,t]=(0,i.useState)(!1),[s,d]=(0,i.useState)(null),handleCloseForm=()=>{t(!1),d(null)};return(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Purchase Orders"}),(0,a.jsx)(u.z,{onClick:()=>t(!0),children:"Create Purchase Order"})]}),(0,a.jsx)(purchases_PurchaseList,{onEditPurchase:e=>{d(e),t(!0)}}),(0,a.jsx)(f.u,{isOpen:e,onClose:handleCloseForm,title:s?"Edit Purchase Order":"Create Purchase Order",size:"xl",children:(0,a.jsx)(purchases_PurchaseForm,{purchaseOrder:s,onSuccess:()=>{handleCloseForm(),window.location.reload()},onCancel:handleCloseForm})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=31076)}),_N_E=e.O()}]);