(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3376],{93969:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/invoices",function(){return a(77612)}])},77612:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return invoices}});var s=a(52322),i=a(2784),l=a(33766),n=a(95775),r=a(56958),d=a(18309),c=a(41742),o=a(75753),u=a(65823),m=a(50502),v=a(16813),invoices_InvoiceList=e=>{let{onEditInvoice:t,onViewInvoice:a,refreshKey:l}=e,[x,h]=(0,i.useState)([]),[p,g]=(0,i.useState)([]),[b,j]=(0,i.useState)(!0),[y,f]=(0,i.useState)({status:"",type:"",customerId:"",startDate:"",endDate:""}),[N,D]=(0,i.useState)({page:1,limit:10,total:0,pages:0}),{get:_,del:I,getBlob:C}=(0,n.h)(),S=(0,i.useCallback)(async()=>{try{j(!0);let e=new URLSearchParams({page:N.page.toString(),limit:N.limit.toString(),...y.status&&{status:y.status},...y.type&&{type:y.type},...y.customerId&&{customerId:y.customerId},...y.startDate&&{startDate:y.startDate},...y.endDate&&{endDate:y.endDate}}),t=await _("/api/invoices?".concat(e));h(t.data),D(t.pagination)}catch(e){r.Am.error((null==e?void 0:e.message)||"Failed to load invoices")}finally{j(!1)}},[_,N.page,N.limit,y]);(0,i.useEffect)(()=>{let fetchCustomers=async()=>{try{let e=await _("/api/customers?limit=100");g(e.data)}catch(e){}};fetchCustomers()},[_]),(0,i.useEffect)(()=>{S()},[S,l]);let handleDelete=async e=>{if(confirm("Are you sure you want to delete this invoice order?"))try{await I("/api/invoices/".concat(e)),r.Am.success("Invoice deleted successfully \uD83D\uDDD1️"),S()}catch(e){r.Am.error((null==e?void 0:e.message)||"Failed to delete invoice ❌")}},handlePrint=async e=>{try{let t=await C("/api/invoices/".concat(e,"/pdf"));if("application/pdf"!==t.type)throw Error("Invalid PDF response");let a=window.URL.createObjectURL(t),s=window.open(a,"_blank");s||r.Am.error("Popup blocked! Please allow popups to view PDF.")}catch(e){r.Am.error((null==e?void 0:e.message)||"Failed to generate invoice PDF ❌")}},handleFilterChange=(e,t)=>{let a="all"===t?"":t;f(t=>({...t,[e]:a})),D(e=>({...e,page:1}))},getStatusBadge=e=>{let{label:t,variant:a}={draft:{label:"Draft",variant:"outline"},sent:{label:"Sent",variant:"default"},viewed:{label:"Viewed",variant:"warning"},partial:{label:"Partial",variant:"warning"},paid:{label:"Paid",variant:"success"},overdue:{label:"Overdue",variant:"danger"},cancelled:{label:"Cancelled",variant:"outline"}}[e]||{label:e,variant:"outline"};return(0,s.jsx)(u.C,{variant:a,children:t})},getTypeBadge=e=>{let{label:t,variant:a}={standard:{label:"Standard",variant:"default"},proforma:{label:"Proforma",variant:"warning"},credit:{label:"Credit",variant:"success"},debit:{label:"Debit",variant:"danger"}}[e]||{label:e,variant:"outline"};return(0,s.jsx)(u.C,{variant:a,children:t})},A=[{key:"invoiceNumber",header:"Invoice",render:(e,t)=>{var a;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:null===(a=t.customer)||void 0===a?void 0:a.name})]})}},{key:"issueDate",header:"Issue Date",render:e=>new Date(e).toLocaleDateString()},{key:"dueDate",header:"Due Date",render:e=>new Date(e).toLocaleDateString()},{key:"status",header:"Status",render:e=>getStatusBadge(e)},{key:"type",header:"Type",render:e=>getTypeBadge(e)},{key:"totalAmount",header:"Total Amount",render:e=>"₹".concat(e.toLocaleString())},{key:"balanceDue",header:"Balance Due",render:e=>(0,s.jsxs)("span",{className:e>0?"text-red-600 font-medium":"text-green-600",children:["₹",e.toLocaleString()]})},{key:"actions",header:"Actions",render:(e,a)=>(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(m.z,{onClick:()=>handlePrint(a.id),variant:"outline",size:"sm",children:"Print"}),"draft"===a.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.z,{onClick:()=>t(a),variant:"outline",size:"sm",children:"Edit"}),(0,s.jsx)(m.z,{onClick:()=>handleDelete(a.id),variant:"danger",size:"sm",children:"Delete"})]})]})}];return b?(0,s.jsx)("div",{children:"Loading invoices..."}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Customer"}),(0,s.jsxs)(o.Ph,{onValueChange:e=>handleFilterChange("customerId",e),value:y.customerId,children:[(0,s.jsx)(o.i4,{children:(0,s.jsx)(o.ki,{placeholder:"All Customers"})}),(0,s.jsxs)(o.Bw,{children:[(0,s.jsx)(o.Ql,{value:"all",children:"All Customers"}),p.map(e=>(0,s.jsx)(o.Ql,{value:e.id,children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Status"}),(0,s.jsxs)(o.Ph,{onValueChange:e=>handleFilterChange("status",e),value:y.status,children:[(0,s.jsx)(o.i4,{children:(0,s.jsx)(o.ki,{placeholder:"All Status"})}),(0,s.jsxs)(o.Bw,{children:[(0,s.jsx)(o.Ql,{value:"all",children:"All Status"}),(0,s.jsx)(o.Ql,{value:"draft",children:"Draft"}),(0,s.jsx)(o.Ql,{value:"sent",children:"Sent"}),(0,s.jsx)(o.Ql,{value:"viewed",children:"Viewed"}),(0,s.jsx)(o.Ql,{value:"partial",children:"Partial"}),(0,s.jsx)(o.Ql,{value:"paid",children:"Paid"}),(0,s.jsx)(o.Ql,{value:"overdue",children:"Overdue"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Type"}),(0,s.jsxs)(o.Ph,{onValueChange:e=>handleFilterChange("type",e),value:y.type,children:[(0,s.jsx)(o.i4,{children:(0,s.jsx)(o.ki,{placeholder:"All Types"})}),(0,s.jsxs)(o.Bw,{children:[(0,s.jsx)(o.Ql,{value:"all",children:"All Types"}),(0,s.jsx)(o.Ql,{value:"standard",children:"Standard"}),(0,s.jsx)(o.Ql,{value:"proforma",children:"Proforma"}),(0,s.jsx)(o.Ql,{value:"credit",children:"Credit"}),(0,s.jsx)(o.Ql,{value:"debit",children:"Debit"})]})]})]}),(0,s.jsx)(v.I,{label:"From Date",type:"date",value:y.startDate,onChange:e=>handleFilterChange("startDate",e.target.value)}),(0,s.jsx)(v.I,{label:"To Date",type:"date",value:y.endDate,onChange:e=>handleFilterChange("endDate",e.target.value)})]}),(0,s.jsx)(d.i,{columns:A,data:x,onRowClick:a,emptyMessage:"No invoices found"}),N.pages>1&&(0,s.jsx)(c.t,{currentPage:N.page,totalPages:N.pages,onPageChange:e=>D(t=>({...t,page:e}))})]})},x=a(63955),h=a(88883),p=a(48359),g=a(78255),b=a(18347),j=a(25237),y=a.n(j);let f=y()(()=>Promise.all([a.e(2138),a.e(9226),a.e(9496),a.e(731),a.e(8126),a.e(467),a.e(7240),a.e(5516),a.e(7578),a.e(3707),a.e(7951),a.e(7302),a.e(2968),a.e(6324),a.e(7737),a.e(6051),a.e(3957),a.e(4812),a.e(5323),a.e(747),a.e(6753),a.e(8870),a.e(5041),a.e(6026),a.e(5429),a.e(8498),a.e(4942),a.e(5702),a.e(8922),a.e(8510),a.e(8424),a.e(553),a.e(7226),a.e(269),a.e(6611),a.e(5341),a.e(5111)]).then(a.bind(a,86192)),{loadableGenerated:{webpack:()=>[86192]},ssr:!1}),N=p.Ry({productId:p.Z_().min(1,"Product is required").optional(),description:p.Z_().min(1,"Description is required"),quantity:p.Rx().min(.01,"Quantity must be greater than 0"),unit:p.Z_().min(1,"Unit is required"),unitPrice:p.Rx().min(.01,"Unit price must be positive"),discount:p.Rx().min(0).max(100).default(0),taxRate:p.Rx().min(0).max(100).default(0),tax_type:p.Z_().min(1,"Tax Type is required").optional(),has_cess:p.O7().default(!1),cess_value:p.Rx().min(0).max(100).default(0)}),D=p.Ry({customerName:p.Z_().min(1,"Customer name is required"),customerEmail:p.Z_().email("Invalid email address"),type:p.Km(["standard","proforma","credit","debit"],{required_error:"Invoice type is required",invalid_type_error:"Invoice type is required"}),issueDate:p.Z_().min(1,"Issue date is required"),paymentTerms:p.Km(["due_on_receipt","net_7","net_15","net_30","net_60"],{required_error:"Payment terms are required",invalid_type_error:"Payment terms are required"}),shippingAddress:p.Z_().optional(),billingAddress:p.Z_().optional(),termsAndConditions:p.Z_().optional(),notes:p.Z_().optional(),items:p.IX(N).min(1,"At least one item is required")});var invoices_InvoiceForm=e=>{var t,a,l,d,c,u,p,j,y,N;let{invoice:_,onSuccess:I,onCancel:C}=e,[S,A]=(0,i.useState)("redeem"),[T,w]=(0,i.useState)([]),[P,k]=(0,i.useState)([]),[F,E]=(0,i.useState)(!0),[Q,R]=(0,i.useState)(0),[q,L]=(0,i.useState)([]),[z,O]=(0,i.useState)(""),[Z,B]=(0,i.useState)(""),{post:V,put:U,get:G}=(0,n.h)(),{get:K}=(0,n.h)(),{register:X,handleSubmit:M,formState:{errors:H,isSubmitting:J},reset:W,control:Y,watch:$,setValue:ee}=(0,x.cI)({resolver:(0,h.F)(D),defaultValues:{customerName:"",customerEmail:"",type:"standard",issueDate:new Date().toISOString().split("T")[0],paymentTerms:"net_15",items:[{productId:"",description:"",quantity:1,unit:"pcs",unitPrice:0,discount:0,taxRate:0,tax_type:"cgst_sgst",has_cess:!1,cess_value:0}]}}),{fields:et,append:ea,remove:es}=(0,x.Dq)({control:Y,name:"items"}),[ei,el]=(0,i.useState)(""),[en,er]=(0,i.useState)(null),ed=$("items"),ec=$("paymentTerms"),eo=$("issueDate");(0,i.useEffect)(()=>{ei&&fetchLoyaltyData(ei)},[ei]);let fetchLoyaltyData=async e=>{if(e)try{let a=await K("/api/loyalty/customer/".concat(e,"/summary"));if(a.success){var t;let e=(null===(t=a.recentTransactions)||void 0===t?void 0:t.map(e=>e.invoiceId))||[];L(e),er({summary:a.summary,recentTransactions:a.recentTransactions,program:a.program})}else r.Am.error(a.error||"Failed to load loyalty data")}catch(e){r.Am.error(e.message||"Error fetching loyalty data")}};(0,i.useEffect)(()=>{let fetchData=async()=>{try{let[e,t]=await Promise.all([G("/api/customers?limit=200"),G("/api/products?limit=200&isActive=true")]),a=Array.isArray(e)?e:Array.isArray(null==e?void 0:e.data)?e.data:[],s=Array.isArray(t)?t:Array.isArray(null==t?void 0:t.data)?t.data:[];w(a),k(s)}catch(e){r.Am.error("Failed to load form data")}finally{E(!1)}};fetchData()},[G]),(0,i.useEffect)(()=>{if(_){var e,t,a,s;el((null===(e=_.customer)||void 0===e?void 0:e.id)||""),W({customerName:(null===(t=_.customer)||void 0===t?void 0:t.name)||"",customerEmail:(null===(a=_.customer)||void 0===a?void 0:a.email)||"",type:_.type,issueDate:_.issueDate.split("T")[0],paymentTerms:_.paymentTerms,shippingAddress:_.shippingAddress,billingAddress:_.billingAddress,termsAndConditions:_.termsAndConditions,notes:_.notes,items:(null!==(s=_.items)&&void 0!==s?s:[]).map(e=>{var t,a,s;return{productId:null!==(t=e.productId)&&void 0!==t?t:"",description:null!==(a=e.description)&&void 0!==a?a:"",quantity:Number(e.quantity)||1,unit:null!==(s=e.unit)&&void 0!==s?s:"pcs",unitPrice:Number(e.unitPrice)||0,discount:Number(e.discount)||0,taxRate:Number(e.taxRate)||0}})})}},[_,W]);let calculateDueDate=(e,t)=>{if(!e)return"";let a=new Date(e);switch(t){case"due_on_receipt":break;case"net_7":a.setDate(a.getDate()+7);break;case"net_15":a.setDate(a.getDate()+15);break;case"net_30":a.setDate(a.getDate()+30);break;case"net_60":a.setDate(a.getDate()+60)}return a.toISOString().split("T")[0]},calculateItemTotals=e=>{let t=e.unitPrice*e.quantity*e.discount/100,a=e.unitPrice*e.quantity-t,s=0;"cgst_sgst"===e.tax_type&&(s=a*e.taxRate/100),"igst"===e.tax_type&&(s=a*e.taxRate/100);let i=e.has_cess?a*e.cess_value/100:0,l=a+s+i;return{discountAmount:t,taxAmount:s,cessAmount:i,lineTotal:l}},calculateOrderTotals=e=>{let t=0,a=0,s=0;return e.forEach(e=>{let i=calculateItemTotals(e);t+=e.unitPrice*e.quantity,s+=i.discountAmount,a+=i.taxAmount+i.cessAmount}),{subTotal:t,taxTotal:a,discountTotal:s,totalAmount:t-s+a,dueTotal:t-s+a-Q}},handleProductChange=(e,t)=>{let a=P.find(e=>e.id===t);a&&(ee("items.".concat(e,".productId"),a.id),ee("items.".concat(e,".description"),a.name),ee("items.".concat(e,".unitPrice"),a.sellingPrice),ee("items.".concat(e,".unit"),a.unit||"pcs"),ee("items.".concat(e,".taxRate"),a.taxRate||0))},onSubmit=async e=>{try{let t={...e,cashBack:Q,issueDate:new Date(e.issueDate).toISOString(),dueDate:calculateDueDate(e.issueDate,e.paymentTerms)};(null==_?void 0:_.id)?(await U("/api/invoices/".concat(_.id),t),r.Am.success("Invoice updated successfully")):(await V("/api/invoices",t),r.Am.success("Invoice created successfully")),I()}catch(e){r.Am.error((null==e?void 0:e.message)||"Failed to save invoice")}};if(F)return(0,s.jsx)("div",{children:"Loading..."});let eu=calculateDueDate(eo,ec),em=calculateOrderTotals(ed);return(0,s.jsxs)("form",{onSubmit:M(onSubmit),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Customer"}),(0,s.jsx)(f,{isClearable:!0,isDisabled:!!_,value:(()=>{let e=$("customerName"),t=T.find(t=>t.name===e);return t?{value:t.id,label:t.name}:e?{value:"new",label:e}:null})(),onChange:e=>{if(!e){ee("customerName",""),ee("customerEmail","");return}let t=T.find(t=>t.id===e.value);t?(ee("customerName",t.name,{shouldDirty:!0}),ee("customerEmail",t.email||"",{shouldDirty:!0}),el(t.id)):(ee("customerName",e.label,{shouldDirty:!0}),ee("customerEmail","",{shouldDirty:!0}))},options:T.map(e=>({value:e.id,label:e.name})),placeholder:"Select or type a customer"}),H.customerName&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:H.customerName.message})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Customer Email"}),(0,s.jsx)(v.I,{...X("customerEmail"),placeholder:"Enter customer email",disabled:!!_||!!T.find(e=>e.name===$("customerName")),error:null===(t=H.customerEmail)||void 0===t?void 0:t.message})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Invoice Type"}),(0,s.jsxs)(o.Ph,{value:$("type"),onValueChange:e=>ee("type",e),children:[(0,s.jsx)(o.i4,{children:(0,s.jsx)(o.ki,{placeholder:"Select invoice type"})}),(0,s.jsxs)(o.Bw,{children:[(0,s.jsx)(o.Ql,{value:"standard",children:"Standard"}),(0,s.jsx)(o.Ql,{value:"proforma",children:"Proforma"}),(0,s.jsx)(o.Ql,{value:"credit",children:"Credit Note"}),(0,s.jsx)(o.Ql,{value:"debit",children:"Debit Note"})]})]}),H.type&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:H.type.message})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsx)(v.I,{label:"Issue Date",type:"date",...X("issueDate"),error:null===(a=H.issueDate)||void 0===a?void 0:a.message,disabled:J}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),(0,s.jsxs)(o.Ph,{value:ec,onValueChange:e=>ee("paymentTerms",e),children:[(0,s.jsx)(o.i4,{children:(0,s.jsx)(o.ki,{placeholder:"Select payment terms"})}),(0,s.jsxs)(o.Bw,{children:[(0,s.jsx)(o.Ql,{value:"due_on_receipt",children:"Due on Receipt"}),(0,s.jsx)(o.Ql,{value:"net_7",children:"Net 7"}),(0,s.jsx)(o.Ql,{value:"net_15",children:"Net 15"}),(0,s.jsx)(o.Ql,{value:"net_30",children:"Net 30"}),(0,s.jsx)(o.Ql,{value:"net_60",children:"Net 60"})]})]}),H.paymentTerms&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:H.paymentTerms.message})]}),(0,s.jsx)(v.I,{label:"Due Date",type:"date",value:eu,disabled:!0,className:"bg-gray-50"})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Items"}),et.map((e,t)=>{var a,i,l,n,r,d,c,u,x,h,p,b,j,y,f,N,D,_,I,C,S,A,T,w,k,F,E,Q;return(0,s.jsxs)("div",{className:"border rounded-lg p-4 mb-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[(0,s.jsxs)("div",{className:"md:col-span-4 flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Product"}),(0,s.jsxs)(o.Ph,{value:(null===(a=ed[t])||void 0===a?void 0:a.productId)||((null===(i=ed[t])||void 0===i?void 0:i.productId)===""?"custom":null===(l=ed[t])||void 0===l?void 0:l.productId),onValueChange:e=>handleProductChange(t,e),children:[(0,s.jsx)(o.i4,{children:(0,s.jsx)(o.ki,{placeholder:"Select Product"})}),(0,s.jsxs)(o.Bw,{children:[(0,s.jsx)(o.Ql,{value:"custom",children:"Custom Item"}),P.map(e=>(0,s.jsx)(o.Ql,{value:e.id,children:e.name},e.id))]})]}),(null===(r=H.items)||void 0===r?void 0:null===(n=r[t])||void 0===n?void 0:n.productId)&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:null===(c=H.items[t])||void 0===c?void 0:null===(d=c.productId)||void 0===d?void 0:d.message})]}),(0,s.jsx)("div",{className:"md:col-span-4",children:(0,s.jsx)(v.I,{label:"Description",...X("items.".concat(t,".description")),error:null===(h=H.items)||void 0===h?void 0:null===(x=h[t])||void 0===x?void 0:null===(u=x.description)||void 0===u?void 0:u.message,disabled:J})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(v.I,{label:"Quantity",type:"number",step:"0.01",...X("items.".concat(t,".quantity"),{valueAsNumber:!0}),error:null===(j=H.items)||void 0===j?void 0:null===(b=j[t])||void 0===b?void 0:null===(p=b.quantity)||void 0===p?void 0:p.message,disabled:J})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(v.I,{label:"Unit",...X("items.".concat(t,".unit")),error:null===(N=H.items)||void 0===N?void 0:null===(f=N[t])||void 0===f?void 0:null===(y=f.unit)||void 0===y?void 0:y.message,disabled:J})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 mt-4",children:[(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(v.I,{label:"Unit Price (₹)",type:"number",step:"0.01",...X("items.".concat(t,".unitPrice"),{valueAsNumber:!0}),error:null===(I=H.items)||void 0===I?void 0:null===(_=I[t])||void 0===_?void 0:null===(D=_.unitPrice)||void 0===D?void 0:D.message,disabled:J})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(v.I,{label:"Discount (%)",type:"number",step:"0.01",...X("items.".concat(t,".discount"),{valueAsNumber:!0}),error:null===(A=H.items)||void 0===A?void 0:null===(S=A[t])||void 0===S?void 0:null===(C=S.discount)||void 0===C?void 0:C.message,disabled:J})}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Tax Type"}),(0,s.jsxs)("select",{...X("items.".concat(t,".tax_type")),className:"w-full border p-2 rounded",children:[(0,s.jsx)("option",{value:"cgst_sgst",children:"CGST & SGST"}),(0,s.jsx)("option",{value:"igst",children:"IGST"})]})]}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(v.I,{label:"Tax Rate (%)",type:"number",step:"0.01",...X("items.".concat(t,".taxRate"),{valueAsNumber:!0}),error:null===(k=H.items)||void 0===k?void 0:null===(w=k[t])||void 0===w?void 0:null===(T=w.taxRate)||void 0===T?void 0:T.message,disabled:J})}),(0,s.jsxs)("div",{className:"md:col-span-1",children:[(0,s.jsx)("input",{type:"checkbox",...X("items.".concat(t,".has_cess"))}),"CESS"]}),$("items.".concat(t,".has_cess"))&&(0,s.jsx)("div",{className:"md:col-span-3",children:(0,s.jsx)(v.I,{label:"CESS Rate (%)",type:"number",step:"0.01",...X("items.".concat(t,".cess_value"),{valueAsNumber:!0}),error:null===(Q=H.items)||void 0===Q?void 0:null===(E=Q[t])||void 0===E?void 0:null===(F=E.cess_value)||void 0===F?void 0:F.message,disabled:J})}),(0,s.jsx)("div",{className:"md:col-span-3",children:(0,s.jsx)(v.I,{label:"Line Total (₹)",type:"number",value:calculateItemTotals(ed[t]).lineTotal.toFixed(2),disabled:!0,className:"bg-gray-50"})}),(0,s.jsx)("div",{className:"md:col-span-2 flex items-end",children:et.length>1&&(0,s.jsx)(m.z,{type:"button",variant:"danger",onClick:()=>es(t),disabled:J,className:"w-full",children:(0,s.jsx)(g.Z,{size:16})})})]})]},e.id)}),(0,s.jsxs)(m.z,{type:"button",variant:"outline",onClick:()=>ea({productId:"",description:"",quantity:1,unit:"pcs",unitPrice:0,discount:0,taxRate:0,tax_type:"cgst_sgst",has_cess:!1,cess_value:0}),disabled:J,className:"mt-2",children:[(0,s.jsx)(b.Z,{size:16,className:"mr-2"}),"Add Item"]})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Invoice Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-md ml-auto",children:[(0,s.jsx)("div",{className:"text-right",children:"Subtotal:"}),(0,s.jsxs)("div",{className:"text-right font-medium",children:["₹",em.subTotal.toFixed(2)]}),(0,s.jsx)("div",{className:"text-right",children:"Discount:"}),(0,s.jsxs)("div",{className:"text-right font-medium text-red-600",children:["-₹",em.discountTotal.toFixed(2)]}),(0,s.jsx)("div",{className:"text-right",children:"Tax:"}),(0,s.jsxs)("div",{className:"text-right font-medium",children:["+₹",em.taxTotal.toFixed(2)]}),(0,s.jsx)("div",{className:"text-right border-t pt-2 font-semibold",children:"Total:"}),(0,s.jsxs)("div",{className:"text-right border-t pt-2 font-semibold",children:["₹",em.totalAmount.toFixed(2)]}),(null==en?void 0:null===(l=en.summary)||void 0===l?void 0:l.availableCashback)>0&&em.totalAmount>=(null==en?void 0:null===(d=en.summary)||void 0===d?void 0:d.availableCashback)&&!q.includes(null!==(N=null==_?void 0:_.id)&&void 0!==N?N:"")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:""}),(0,s.jsxs)("div",{className:"text-right pt-2 font-semibold",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{let e="redeemed"===S?"redeem":"redeemed";if(A(e),"redeemed"===e){var t;R((null==en?void 0:null===(t=en.summary)||void 0===t?void 0:t.availableCashback)||0),calculateOrderTotals(ed)}else R(0),calculateOrderTotals(ed)},className:"px-2 py-1 text-xs rounded-md text-white font-semibold\n      ".concat("redeemed"===S?"bg-green-600":"bg-blue-600","\n    "),children:"redeemed"===S?"Redeemed":"Redeem"})," ",(0,s.jsxs)("span",{className:"ml-2 text-sm",children:["(₹",null==en?void 0:null===(c=en.summary)||void 0===c?void 0:c.availableCashback,")"]})]})]}),(0,s.jsx)("div",{className:"text-right border-t pt-2 font-semibold",children:"Due:"}),(0,s.jsxs)("div",{className:"text-right border-t pt-2 font-semibold",children:["₹",em.dueTotal.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,s.jsx)(v.I,{label:"Shipping Address",...X("shippingAddress"),error:null===(u=H.shippingAddress)||void 0===u?void 0:u.message,disabled:J}),(0,s.jsx)(v.I,{label:"Billing Address",...X("billingAddress"),error:null===(p=H.billingAddress)||void 0===p?void 0:p.message,disabled:J}),(0,s.jsx)(v.I,{label:"Terms & Conditions",...X("termsAndConditions"),error:null===(j=H.termsAndConditions)||void 0===j?void 0:j.message,disabled:J}),(0,s.jsx)(v.I,{label:"Notes",...X("notes"),error:null===(y=H.notes)||void 0===y?void 0:y.message,disabled:J})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)(m.z,{type:"button",variant:"outline",onClick:C,disabled:J,children:"Cancel"}),(0,s.jsx)(m.z,{type:"submit",isLoading:J,children:_?"Update Invoice":"Create Invoice"})]})]})},_=a(7050),invoices=()=>{let[e,t]=(0,i.useState)(!1),[a,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(null),[o,u]=(0,i.useState)(null),[v,x]=(0,i.useState)(0),handleCloseForm=()=>{t(!1),c(null)};return(0,s.jsx)(l.Z,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Invoices"}),(0,s.jsx)(m.z,{onClick:()=>t(!0),children:"Create Invoice"})]}),(0,s.jsx)(invoices_InvoiceList,{onEditInvoice:e=>{c(e),t(!0)},onViewInvoice:e=>{u(e),n(!0)},refreshKey:v}),(0,s.jsx)(_.u,{isOpen:e,onClose:handleCloseForm,title:d?"Edit Invoice":"Create Invoice",size:"xl",children:(0,s.jsx)(invoices_InvoiceForm,{invoice:d,onSuccess:()=>{r.Am.success("Invoice saved successfully ✅"),handleCloseForm(),x(e=>e+1)},onCancel:handleCloseForm})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=93969)}),_N_E=e.O()}]);