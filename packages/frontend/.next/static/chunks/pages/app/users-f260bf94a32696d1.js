(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8518],{19885:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/users",function(){return a(72606)}])},72606:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return users}});var r=a(52322),t=a(2784),i=a(33766),l=a(18309),d=a(41742),n=a(95775),o=a(56958),users_UserList=e=>{let{onEditUser:s,refreshTrigger:a}=e,[i,c]=(0,t.useState)([]),[u,m]=(0,t.useState)(!0),[x,p]=(0,t.useState)({page:1,limit:10,total:0,pages:0}),{get:h,del:f}=(0,n.h)(),fetchUsers=async()=>{try{let e=await h("/api/users?page=".concat(x.page,"&limit=").concat(x.limit));c(e.data),p(e.pagination)}catch(e){o.Am.error((null==e?void 0:e.message)||"Failed to load users ❌")}finally{m(!1)}};(0,t.useEffect)(()=>{fetchUsers()},[x.page,x.limit,a]);let handleDelete=async e=>{if(confirm("Are you sure you want to delete this user?"))try{await f("/api/users/".concat(e)),o.Am.success("User deleted successfully \uD83D\uDDD1️"),fetchUsers()}catch(e){o.Am.error((null==e?void 0:e.message)||"Failed to delete user ❌")}},v=[{key:"firstName",header:"Name",render:(e,s)=>(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold",children:null==e?void 0:e.charAt(0)}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsxs)("div",{className:"font-medium text-gray-900",children:[s.firstName," ",s.lastName]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:s.email})]})]})},{key:"role",header:"Role",render:e=>(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:e.replace("_"," ").toUpperCase()})},{key:"status",header:"Status",render:e=>(0,r.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat("active"===e?"bg-green-100 text-green-800":"invited"===e?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.toUpperCase()})},{key:"createdAt",header:"Joined",render:e=>new Date(e).toLocaleDateString()},{key:"actions",header:"Actions",render:(e,a)=>(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{onClick:()=>s(a),className:"text-blue-600 hover:text-blue-900 font-medium",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>handleDelete(a.id),className:"text-red-600 hover:text-red-900 font-medium",children:"Delete"})]})}];return u?(0,r.jsx)("div",{children:"Loading users..."}):(0,r.jsxs)("div",{children:[(0,r.jsx)(l.i,{columns:v,data:i,emptyMessage:"No users found"}),x.pages>1&&(0,r.jsx)(d.t,{currentPage:x.page,totalPages:x.pages,onPageChange:e=>{p(s=>({...s,page:e}))}})]})},c=a(63955),u=a(48359),m=a(88883),x=a(16813),p=a(50502);let h=u.Ry({id:u.Z_().optional(),firstName:u.Z_().min(1,"First name is required"),lastName:u.Z_().min(1,"Last name is required"),email:u.Z_().email("Invalid email address"),password:u.Z_().min(8,"Password must be at least 8 characters").optional(),role:u.Km(["super_admin","admin","finance","sales","support","member","user","professional"],{required_error:"Role is required"}),status:u.Km(["active","invited","suspended"]).default("active"),biometricEnabled:u.O7().optional()}).refine(e=>!e.id||!!e.password,{message:"Password is required for new users"});var users_UserForm=e=>{var s,a,i,l;let{user:d,onSuccess:u,onCancel:f,onRefresh:v}=e,{post:b,put:g}=(0,n.h)(),{register:j,handleSubmit:N,formState:{errors:y,isSubmitting:w},reset:_,watch:E}=(0,c.cI)({resolver:(0,m.F)(h),defaultValues:{status:"active",role:"user",biometricEnabled:!1}});(0,t.useEffect)(()=>{if(d){var e;_({firstName:d.firstName,lastName:d.lastName,email:d.email,role:d.role,status:d.status,biometricEnabled:null!==(e=d.biometricEnabled)&&void 0!==e&&e})}},[d,_]);let handleApiError=(e,s)=>{var a,r;(null==e?void 0:null===(a=e.message)||void 0===a?void 0:a.includes("fails to match"))||(null==e?void 0:null===(r=e.message)||void 0===r?void 0:r.includes("is required"))?e.message.split(",").forEach(e=>o.Am.error(e.trim())):o.Am.error((null==e?void 0:e.message)||s)},onSubmit=async e=>{try{let s={firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:e.role,status:e.status,biometricEnabled:e.biometricEnabled||!1};(null==d?void 0:d.id)?(await g("/api/users/".concat(d.id),s),o.Am.success("User updated successfully ✅")):(await b("/api/users",s),o.Am.success("User created successfully ✅")),v(),u()}catch(s){let e=(null==s?void 0:s.message)||"Failed to save user ❌";handleApiError(s,e)}};return(0,r.jsxs)("form",{onSubmit:N(onSubmit),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(x.I,{label:"First Name",...j("firstName"),error:null===(s=y.firstName)||void 0===s?void 0:s.message,disabled:w,required:!0}),(0,r.jsx)(x.I,{label:"Last Name",...j("lastName"),error:null===(a=y.lastName)||void 0===a?void 0:a.message,disabled:w,required:!0})]}),(0,r.jsx)(x.I,{label:"Email",type:"email",...j("email"),error:null===(i=y.email)||void 0===i?void 0:i.message,disabled:w,required:!0}),!d&&(0,r.jsx)(x.I,{label:"Password",type:"password",...j("password"),error:null===(l=y.password)||void 0===l?void 0:l.message,disabled:w,required:!0}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),(0,r.jsxs)("select",{...j("role"),className:"w-full border rounded p-2",disabled:w,children:[(0,r.jsx)("option",{value:"",children:"Select Role"}),(0,r.jsx)("option",{value:"super_admin",children:"Super Admin"}),(0,r.jsx)("option",{value:"admin",children:"Admin"}),(0,r.jsx)("option",{value:"finance",children:"Finance"}),(0,r.jsx)("option",{value:"sales",children:"Sales"}),(0,r.jsx)("option",{value:"support",children:"Support"}),(0,r.jsx)("option",{value:"member",children:"Member"}),(0,r.jsx)("option",{value:"user",children:"User"})]}),y.role&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:y.role.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,r.jsxs)("select",{...j("status"),className:"w-full border rounded p-2",disabled:w,children:[(0,r.jsx)("option",{value:"active",children:"Active"}),(0,r.jsx)("option",{value:"invited",children:"Invited"}),(0,r.jsx)("option",{value:"suspended",children:"Suspended"})]}),y.status&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:y.status.message})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"biometricEnabled",...j("biometricEnabled"),disabled:w}),(0,r.jsx)("label",{htmlFor:"biometricEnabled",className:"text-sm text-gray-700",children:"Enable Biometric Authentication"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)(p.z,{type:"button",variant:"outline",onClick:f,disabled:w,children:"Cancel"}),(0,r.jsx)(p.z,{type:"submit",isLoading:w,children:d?"Update User":"Create User"})]})]})},f=a(7050),users=()=>{let[e,s]=(0,t.useState)(!1),[a,l]=(0,t.useState)(null),[d,n]=(0,t.useState)(0),triggerRefresh=()=>{n(e=>e+1)},handleCloseForm=()=>{s(!1),l(null)};return(0,r.jsx)(i.Z,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Users"}),(0,r.jsx)(p.z,{onClick:()=>s(!0),children:"Add User"})]}),(0,r.jsx)(users_UserList,{onEditUser:e=>{l(e),s(!0)},refreshTrigger:d}),(0,r.jsx)(f.u,{isOpen:e,onClose:handleCloseForm,title:a?"Edit User":"Add User",size:"lg",children:(0,r.jsx)(users_UserForm,{user:a,onSuccess:()=>{handleCloseForm(),triggerRefresh()},onCancel:handleCloseForm,onRefresh:triggerRefresh})})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=19885)}),_N_E=e.O()}]);