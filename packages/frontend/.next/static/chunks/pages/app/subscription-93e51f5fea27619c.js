(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4896],{41056:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/subscription",function(){return t(51028)}])},51028:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return SubscriptionPage}});var s=t(52322),r=t(2784),n=t(33766);let Card=e=>{let{children:a,className:t=""}=e;return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden ".concat(t),children:a})},CardHeader=e=>{let{children:a,className:t=""}=e;return(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 ".concat(t),children:a})},CardTitle=e=>{let{children:a,className:t=""}=e;return(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-800 ".concat(t),children:a})},CardContent=e=>{let{children:a,className:t=""}=e;return(0,s.jsx)("div",{className:"px-6 py-4 ".concat(t),children:a})},CardFooter=e=>{let{children:a,className:t=""}=e;return(0,s.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 ".concat(t),children:a})};var i=t(50502),l=t(65823),c=t(17259);let Dialog=e=>{let{open:a,onClose:t,children:r,className:n=""}=e;return a?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:t}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-lg rounded-lg bg-white shadow-lg ".concat(n),children:r})]}):null},DialogHeader=e=>{let{children:a}=e;return(0,s.jsx)("div",{className:"flex items-center justify-between border-b p-4",children:a})},DialogTitle=e=>{let{children:a}=e;return(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:a})},DialogContent=e=>{let{children:a}=e;return(0,s.jsx)("div",{className:"p-4",children:a})};var d=t(5955),o=t(95775),u=t(56958);function PaymentModal(e){let{isOpen:a,onClose:t,onSuccess:n,order:i,paymentId:l}=e,{post:c}=(0,o.h)(),m=(0,r.useRef)(!1);(0,r.useEffect)(()=>{a&&i&&!m.current&&(m.current=!0,loadRazorpayScript())},[a,i]);let loadRazorpayScript=()=>{if(document.querySelector('script[src="https://checkout.razorpay.com/v1/checkout.js"]')){initializeRazorpay();return}let e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,e.onload=initializeRazorpay,document.body.appendChild(e)},initializeRazorpay=()=>{if(!window.Razorpay){u.Am.error("Razorpay SDK not loaded");return}let e={key:"rzp_test_RIzVBhLCVLhGzT",amount:i.amount,currency:i.currency,name:"BillingSoftware SaaS",description:"Subscription Payment",order_id:i.id,handler:async e=>{try{let a=await c("/api/subscriptions/payment/success",{razorpay_payment_id:e.razorpay_payment_id,razorpay_order_id:e.razorpay_order_id,razorpay_signature:e.razorpay_signature,payment_id:l});(null==a?void 0:a.success)?(u.Am.success("Payment successful!"),n()):u.Am.error((null==a?void 0:a.message)||"Payment verification failed")}catch(e){u.Am.error("Error processing payment")}},modal:{ondismiss:()=>{t()}},theme:{color:"#4f46e5"}},a=new window.Razorpay(e);a.open()};return(0,s.jsx)(Dialog,{open:a,onClose:t,children:(0,s.jsxs)(DialogContent,{children:[(0,s.jsx)(DialogHeader,{children:(0,s.jsx)(DialogTitle,{children:"Redirecting to Razorpay..."})}),(0,s.jsxs)("div",{className:"text-center py-6",children:[(0,s.jsx)(d.Z,{className:"h-8 w-8 animate-spin mx-auto mb-3"}),(0,s.jsxs)("p",{children:["Preparing secure payment of ₹",(i.amount/100).toFixed(2)]})]})]})})}function SubscriptionPlans(e){let{plans:a,currentPlan:t,history:n=[],isLoading:d}=e,{post:m}=(0,o.h)(),[p,x]=(0,r.useState)(!1),[h,y]=(0,r.useState)(null),[b,g]=(0,r.useState)(null),handleSubscribe=async e=>{try{u.Am.info("Creating order...");let a=await m("/api/subscriptions/create-order",{planId:e});if(null==a?void 0:a.success){if(a.data.freeTrial){u.Am.success(a.data.message||"Free trial activated successfully"),setTimeout(()=>{window.location.reload()},1500);return}y({id:a.data.orderId,amount:a.data.amount,currency:a.data.currency}),g(a.data.paymentId),x(!0)}else u.Am.error((null==a?void 0:a.message)||"Failed to create order")}catch(e){u.Am.error("Error creating order")}};return(0,s.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Your Subscription"}),t?(0,s.jsxs)(Card,{className:"mb-6",children:[(0,s.jsxs)(CardHeader,{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(CardTitle,{children:t.planName}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Expires: ",t.endDate?new Date(t.endDate).toLocaleDateString():"—"]})]}),(0,s.jsx)("div",{children:(0,s.jsx)(l.C,{children:"Current Active Plan"})})]}),(0,s.jsx)(CardContent,{children:(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Started: ",t.startDate?new Date(t.startDate).toLocaleDateString():"—"]})})]}):(0,s.jsx)("div",{className:"text-sm text-muted-foreground mb-6",children:"You do not have an active subscription."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Available Plans"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.map(e=>{var a,r;return(0,s.jsxs)(Card,{className:"border p-4",children:[(0,s.jsxs)(CardHeader,{className:"text-center pb-4",children:[(0,s.jsx)(CardTitle,{className:"text-2xl font-bold",children:e.name}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:e.description}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("span",{className:"text-4xl font-bold",children:["₹",e.price]}),(0,s.jsxs)("span",{className:"text-muted-foreground ml-2",children:["/","yearly"===e.billingCycle?"year":"monthly"===e.billingCycle?"month":"weekly"===e.billingCycle?"week":"5days"===e.billingCycle?"5 days":""]})]})]}),(0,s.jsx)(CardContent,{className:"space-y-3",children:e.features.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4 text-green-500"}),(0,s.jsx)("span",{children:e})]},a))}),(0,s.jsx)(CardFooter,{children:(0,s.jsx)(i.z,{className:"w-full",size:"lg",onClick:()=>handleSubscribe(e.id),disabled:d||(null==t?void 0:t.planId)===e.id||0===Number(e.price)&&(null!==(a=null==n?void 0:n.length)&&void 0!==a?a:0)>0,children:(null==t?void 0:t.planId)===e.id?"Current Plan":0===Number(e.price)&&(null!==(r=null==n?void 0:n.length)&&void 0!==r?r:0)>0?"Free Trial Unavailable":"Subscribe Now"})})]},e.id)})})]}),p&&h&&(0,s.jsx)(PaymentModal,{isOpen:p,onClose:()=>x(!1),onSuccess:()=>{x(!1),u.Am.success("Subscription activated!"),setTimeout(()=>{window.location.reload()},1500)},order:h,paymentId:b}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Subscription History"}),0===n.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No subscription history found."}):(0,s.jsx)("div",{className:"space-y-3",children:n.map(e=>{var a;return(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-4 bg-white",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold",children:e.planName}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.startDate?new Date(e.startDate).toLocaleDateString():"—"," — ",e.endDate?new Date(e.endDate).toLocaleDateString():"—"]})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsx)(l.C,{variant:"active"===e.status?"success":"expired"===e.status?"danger":"warning",children:null===(a=e.status)||void 0===a?void 0:a.toString().toUpperCase()})})]},e.id)})})]})]})}function SubscriptionPage(){let{get:e,post:a}=(0,o.h)(),[t,i]=(0,r.useState)([]),[l,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(null),[p,x]=(0,r.useState)(null),[h,y]=(0,r.useState)(!1),[b,g]=(0,r.useState)(null),[v,f]=(0,r.useState)(""),[j,N]=(0,r.useState)(!1),fetchPlans=async()=>{try{let a=await e("/api/subscriptions/plans");if(null==a?void 0:a.success){let e=a.data||{};i(e.plans||[]),c(e.history||[]),m(e.currentPlan||null)}else u.Am.error((null==a?void 0:a.message)||"Failed to load subscription plans")}catch(e){u.Am.error((null==e?void 0:e.message)||"Failed to load subscription plans")}};(0,r.useEffect)(()=>{fetchPlans()},[e]);let handleSubscribe=async e=>{try{N(!0),x(e);let t=await a("/api/subscriptions/create-order",{planId:e});if(!(null==t?void 0:t.orderId))throw Error("Invalid order response");g({id:t.orderId,amount:t.amount,currency:t.currency}),f(t.paymentId||""),y(!0)}catch(e){var t,s;u.Am.error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||e.message||"Something went wrong")}finally{N(!1)}},handlePaymentSuccess=async()=>{y(!1),u.Am.success("Payment successful!"),await fetchPlans()};return(0,s.jsx)(n.Z,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Subscription Plans"}),(0,s.jsx)(SubscriptionPlans,{plans:t,currentPlan:d||void 0,history:l,onSubscribe:handleSubscribe,isLoading:j}),b&&(0,s.jsx)(PaymentModal,{isOpen:h,onClose:()=>y(!1),onSuccess:handlePaymentSuccess,order:b,paymentId:v})]})})}}},function(e){e.O(0,[2138,9226,9496,731,8126,467,7240,5516,7578,3707,7951,7302,2968,6324,7737,6051,3957,4812,5323,747,6753,8870,5041,6026,5429,8498,4942,5702,8922,8510,8424,553,7226,269,6611,5341,5111,8592,2888,179],function(){return e(e.s=41056)}),_N_E=e.O()}]);